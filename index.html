<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/link-300x300.gif?v=5.1.0" />






<meta name="description" content="FIND THE CHILD">
<meta property="og:type" content="website">
<meta property="og:title" content="Mapz&#39;s Blog">
<meta property="og:url" content="http://Mapz.github.io/index.html">
<meta property="og:site_name" content="Mapz&#39;s Blog">
<meta property="og:description" content="FIND THE CHILD">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mapz&#39;s Blog">
<meta name="twitter:description" content="FIND THE CHILD">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://Mapz.github.io/"/>





  <title> Mapz's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?69c67c43ced4b46e7ba1656a83e9c872";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mapz's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">可以递归的函数指针</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2021/05/17/UE4-游戏关闭流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/05/17/UE4-游戏关闭流程/" itemprop="url">
                  UE4 游戏关闭流程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T16:00:58+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2021/05/17/UE4-游戏关闭流程/" class="leancloud_visitors" data-flag-title="UE4 游戏关闭流程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>有时候我们需要在 UE4 关闭游戏的时候，处理一些事情，那么可以重写 UGameInstance::ShutDown()</p>
<p>但是有时候在游戏关闭的时候，这个函数并未调用，于是我有必要探究一番他的调用链</p>
<p>这里仅讨论 Engine 而不讨论 EditorEngine</p>
<p>调用斩</p>
<ul>
<li>UGameInstance::ShutDown()</li>
<li>UGameEngine::PreExit()</li>
<li>FEngineLoop::Exit()</li>
<li>调用 EngineExit 或者平台调用退出</li>
<li>EngineExit 被放在了 GuardedMain 函数中定义的一个结构体中</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// make sure GEngineLoop::Exit() is always called.</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EngineLoopCleanupGuard</span> </span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">	~EngineLoopCleanupGuard()</span><br><span class="line">	&#123;</span><br><span class="line">		EngineExit();</span><br><span class="line">	&#125;</span><br><span class="line">&#125; CleanupGuard;</span><br></pre></td></tr></table></figure>
<p>也就是说游戏 Main 函数结束执行的时候，一定会执行 ShutDown</p>
<p>那么为什么我测试的时候日志中没有出现 ShutDown 相关内容呢</p>
<p>检查发现我们调用关闭游戏的时候用的是</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FPlatformMisc::RequestExit(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> FWindowsPlatformMisc::RequestExit( <span class="keyword">bool</span> Force )</span><br><span class="line">&#123;</span><br><span class="line">	UE_LOG(LogWindows, Log,  TEXT(<span class="string">"FPlatformMisc::RequestExit(%i)"</span>), Force );</span><br><span class="line"></span><br><span class="line">	RequestEngineExit(TEXT(<span class="string">"Win RequestExit"</span>));</span><br><span class="line">	FCoreDelegates::ApplicationWillTerminateDelegate.Broadcast();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>( Force )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// Force immediate exit. In case of an error set the exit code to 3.</span></span><br><span class="line">		<span class="comment">// Dangerous because config code isn't flushed, global destructors aren't called, etc.</span></span><br><span class="line">		<span class="comment">// Suppress abort message and MS reports.</span></span><br><span class="line">		<span class="comment">//_set_abort_behavior( 0, _WRITE_ABORT_MSG | _CALL_REPORTFAULT );</span></span><br><span class="line">		<span class="comment">//abort();</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">// Make sure the log is flushed.</span></span><br><span class="line">		<span class="keyword">if</span>( GLog )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// This may be called from other thread, so set this thread as the master.</span></span><br><span class="line">			GLog-&gt;SetCurrentThreadAsMasterThread();</span><br><span class="line">			GLog-&gt;TearDown();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		TerminateProcess(GetCurrentProcess(), GIsCriticalError ? <span class="number">3</span> : <span class="number">0</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// Tell the platform specific code we want to exit cleanly from the main loop.</span></span><br><span class="line">		PostQuitMessage( <span class="number">0</span> );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见传入 true 为参数的时候，直接把进程杀了，导致未执行 UGameInstance::ShutDown()</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2019/01/17/Unity学习：像素FC还原游戏SuperSimon（一）准备工作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/01/17/Unity学习：像素FC还原游戏SuperSimon（一）准备工作/" itemprop="url">
                  Unity学习：像素FC还原游戏SuperSimon（一）准备工作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T16:44:09+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/01/17/Unity学习：像素FC还原游戏SuperSimon（一）准备工作/" class="leancloud_visitors" data-flag-title="Unity学习：像素FC还原游戏SuperSimon（一）准备工作">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现在开始正式制作我们的FC重制游戏 SuperSimon</p>
<h2 id="创建环境"><a href="#创建环境" class="headerlink" title="创建环境"></a>创建环境</h2><ol>
<li>Unity 2018.3</li>
<li>使用 Package Manager 下载 2D Pixel Perfect 插件（需要设置 Package Manager 的高级设置，打开显示预览包</li>
<li>因为本次使用新的输入包，使用 Package Manager 下载 Input System</li>
<li>使用 <a href="https://mapz.github.io/2019/01/17/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AFC%E4%B8%AD%E6%8A%A0%E5%87%BA%E6%9D%A5%E7%9A%84%E5%AD%97%E4%BD%93%E5%81%9A%E6%88%90BitmapFont/">这里</a> 的文章中的方式，从恶魔城3的SpriteSheet中创建好字体</li>
</ol>
<img src="/2019/01/17/Unity学习：像素FC还原游戏SuperSimon（一）准备工作/CV3Font.png" title="Dump的字体图片">
<h2 id="场景中的内容"><a href="#场景中的内容" class="headerlink" title="场景中的内容"></a>场景中的内容</h2><ol>
<li>摄像机设置正交，背景色 solid color,大小128</li>
<li>摄像机GO上添加一个 Pixel Perfect Camera，设置pixel perUnit 1,分辨率256 x 240,下面钩子全打上</li>
<li>创建UICanvas，用摄像机 Render，Pixel perfect 勾上，Canvas Scaler 分辨率设置好，模式选择随屏幕大小缩放。 pixel per unit 1。Match mode expand。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2019/01/17/Unity学习：FC中抠出来的字体做成BitmapFont/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/01/17/Unity学习：FC中抠出来的字体做成BitmapFont/" itemprop="url">
                  Unity学习：FC中抠出来的字体做成BitmapFont
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T16:12:22+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/01/17/Unity学习：FC中抠出来的字体做成BitmapFont/" class="leancloud_visitors" data-flag-title="Unity学习：FC中抠出来的字体做成BitmapFont">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>做像素游戏的时候，你通常会自定义字体，或者绘制像素字体。</p>
<p>字体画好，或者像我们一样直接从 FC 游戏里面抠出图集来之后，怎么样来做成BitmapFont呢？</p>
<p>网上的内容通常教你怎么从安装好的ttf来导出，现在我们手上只有 PNG 怎么办呢？</p>
<h2 id="用到的工具"><a href="#用到的工具" class="headerlink" title="用到的工具"></a>用到的工具</h2><ul>
<li>BMFont</li>
<li>Unity</li>
</ul>
<h2 id="假设"><a href="#假设" class="headerlink" title="假设"></a>假设</h2><ol>
<li>我们的字符图集中文字大小都是 8 X 8,并且无间隔（也可以是其他大小，总之Unity可以自动按格子大小来切就行）</li>
</ol>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>我们从FC Dump 下来的字体图集，一般都是8x8的字符集，为了能够使用BMFont来导出Bitmap Font，我们需要先把这个图集打成单个的字符。</li>
<li>打开 Unity，导入字符集图片，导入设置为 压缩-&gt;无，并把可读写打开，Sprite类型为多个</li>
<li>打开 Sprite Editor ，切片方式 By Cell Size 大小 8 x 8，切好图集</li>
<li>使用如下脚本导出为单个的图片</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">using UnityEditor;</span><br><span class="line">using UnityEngine;</span><br><span class="line">static class BitmapFontTool &#123;</span><br><span class="line">    [MenuItem (&quot;BitmapFontTool/导出切好的Sprite&quot;)]</span><br><span class="line">    static void SaveSprite () &#123;</span><br><span class="line">        //每一张贴图类型Advanced下 Read/Write Enabled打上勾才能进行文件读取</span><br><span class="line">        //导入类型不能是压缩过的</span><br><span class="line">        string bitMapfontPath = @&quot;Assets/BitmapFontTool/&quot;;</span><br><span class="line">        foreach (Object obj in Selection.objects) &#123;</span><br><span class="line"></span><br><span class="line">            string selectionPath = AssetDatabase.GetAssetPath (obj);</span><br><span class="line">            string selectionExt = System.IO.Path.GetExtension (selectionPath);</span><br><span class="line">            string fileName = System.IO.Path.GetFileNameWithoutExtension (selectionPath);</span><br><span class="line">            string loadPath = selectionPath.Substring (0, selectionPath.Length - selectionExt.Length);</span><br><span class="line">            if (selectionExt.Length == 0) continue;</span><br><span class="line"></span><br><span class="line">            //加载此文件下的所有资源</span><br><span class="line">            Object[] spriteList = AssetDatabase.LoadAllAssetsAtPath (selectionPath); </span><br><span class="line"></span><br><span class="line">            if (spriteList.Length &gt; 0) &#123;</span><br><span class="line">                //创建导出文件夹</span><br><span class="line">                string outPath = bitMapfontPath + &quot;/SpriteExportOutput/&quot; + fileName;</span><br><span class="line">                System.IO.Directory.CreateDirectory (outPath);</span><br><span class="line"></span><br><span class="line">                foreach (var sprite in spriteList) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        var sprite_ = (Sprite) sprite;</span><br><span class="line">                        Texture2D tex = new Texture2D ((int) sprite_.rect.width, (int) sprite_.rect.height, sprite_.texture.format, false);</span><br><span class="line">                        tex.SetPixels (sprite_.texture.GetPixels ((int) sprite_.rect.xMin, (int) sprite_.rect.yMin, (int) sprite_.rect.width, (int) sprite_.rect.height));</span><br><span class="line">                        tex.Apply ();</span><br><span class="line">                        //写出成png文件</span><br><span class="line">                        System.IO.File.WriteAllBytes (outPath + &quot;/&quot; + sprite_.name + &quot;.png&quot;, tex.EncodeToPNG ());</span><br><span class="line">                        Debug.Log (&quot;SaveSprite to&quot; + outPath);</span><br><span class="line">                    &#125; catch (System.Exception e) &#123;</span><br><span class="line">                        Debug.Log (e);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                Debug.Log (&quot;保存图片完毕!&quot; + outPath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>网上搜索 BMFont 教程，按教程使用导出的图片，创建 fnt 字体</li>
<li>把输出的文件导入 Unity ,下载 BitmapFontImporter 插件</li>
<li>Assets -&gt; Bitmap Font -&gt; build 创建 Unity 自定义字体</li>
<li>使用字体</li>
</ol>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ol>
<li>BMFont 导入大量图片文件的时候非常的难用，不适合批量使用</li>
<li>既然已经有图集了，何不在图集上自己创建fnt文件呢？</li>
</ol>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>在Unity下，自己写个工具来制作fnt也并不难<br>挖个坑留着以后来尝试</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2019/01/17/Unity学习：开新坑，Super-Simon-Adv/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/01/17/Unity学习：开新坑，Super-Simon-Adv/" itemprop="url">
                  Unity学习：开新坑，Super_Simon_Adv
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T11:00:16+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/01/17/Unity学习：开新坑，Super-Simon-Adv/" class="leancloud_visitors" data-flag-title="Unity学习：开新坑，Super_Simon_Adv">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>之前做了 FC 荒野大镖客的 retro demo</p>
<p>总结了一些问题，现在准备先放在一边，不想改了</p>
<p>根据总结的这些问题，开个新坑吧</p>
<p>准备弄成一个 FC 大杂烩游戏</p>
<h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><p>恶魔城西蒙的大冒险</p>
<p>素材为各个 FC 游戏内容</p>
<p>横版 Platform<br>根据可能 也会变成 横版清关</p>
<h2 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h2><p>还原 FC 的 256 X 240 分辨率</p>
<h2 id="预计用到的内容和改进"><a href="#预计用到的内容和改进" class="headerlink" title="预计用到的内容和改进"></a>预计用到的内容和改进</h2><ol>
<li>之前的 Demo 没有经过设计，想到哪写到哪，太潦草，所以这次先设计好再出发</li>
<li>这次使用 CSV 的方式来配置单位属性，并初始化</li>
<li>Pixel Perfect 摄像机</li>
<li>先弄成单机打包模式，后期再弄成可热更新模式</li>
<li>先期接入 Lua</li>
<li>使用 Unity 的 Preview 新输入方式</li>
<li>AI 使用 行为树</li>
<li>使用一些 Shader 来制作效果</li>
<li>生怪器的进一步优化</li>
<li>做一个从 PNG 导出 Bitmap Font 的工具</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2018/12/11/Unity学习：ProjectTiny现状（即时更新）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/12/11/Unity学习：ProjectTiny现状（即时更新）/" itemprop="url">
                  Unity学习：ProjectTiny现状（即时更新）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-11T15:33:34+08:00">
                2018-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/11/Unity学习：ProjectTiny现状（即时更新）/" class="leancloud_visitors" data-flag-title="Unity学习：ProjectTiny现状（即时更新）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TileMap"><a href="#TileMap" class="headerlink" title="TileMap"></a>TileMap</h2><ul>
<li>可以编辑，可以使用，但是现在无物理特性（Platform游戏可以先等等），不能设置碰撞</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/" itemprop="url">
                  Unity学习：ProjectTiny学习（二）弹球和2D物理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-10T14:40:38+08:00">
                2018-12-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/" class="leancloud_visitors" data-flag-title="Unity学习：ProjectTiny学习（二）弹球和2D物理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>接着上次我们继续来玩 Tiny Mode</p>
<h2 id="创建一个新项目"><a href="#创建一个新项目" class="headerlink" title="创建一个新项目"></a>创建一个新项目</h2><p>菜单 -&gt; tiny -&gt; file -&gt; new project </p>
<p>创建新的项目 TinyNew</p>
<p>我们可以看到，在 Asset 目录下创建了一个新的名为 TinyNew 的目录</p>
<p>下面有一个 TinyNew.utproject 文件</p>
<p>这个文件就是 tiny mode 的项目文件了</p>
<p>和 Unity 不同，tiny mode 不存在 Scene </p>
<p>双击项目文件，就可以加载项目了</p>
<p>项目的 Inspector 如图</p>

<p>可以选择 Build 类型，需要加载的模块</p>
<p>还有显示设置以及物理设置</p>
<p>从可加载的模块看我们现在基本也可以知道 Tiny Mode 现有的功能有哪些</p>
<p>物理选项只有一个重力，可以看出相比 Unity 本体非常的精简</p>
<p>我们要做的是平面上球触边弹的效果，所以重力设置为 0</p>
<hr>
<h2 id="开始创建主实体"><a href="#开始创建主实体" class="headerlink" title="开始创建主实体"></a>开始创建主实体</h2><p>以前我们的各种玩意，都是放在 GameObject 上的，在 ECS 中，GameObject 没有了，用来放内容的变成了 Entity，所以还是老一套，需要一个 Entity 来放置摄像机什么的</p>
<p>创建一个新的 Entity 现阶段只能从 Tiny 菜单 Create EntityGroup 或者层级图中，点击 Create EntityGroup</p>
<p>我们在 Entities 目录下新建一个 MainGroup，点击后</p>
<p>在 EntityGroup 的 Inspector 中可以看到两个按钮</p>

<ul>
<li>Load: 加载这个组的一个 Entity 实例到层级图中，方便操作</li>
<li>Set as StartUp: 设置为初始 Group，游戏启动时，会自动加载，不能被 Unload</li>
</ul>
<p>我们把 MainGroup 设置为启动加载</p>
<p>在 MainGroup 右边的小菜单里面选择 Camera 新增一个 Camera</p>
<p>再 Create Empty，新建一个空组件，命名为 Spawner，用来产生球球</p>
<p>再 Create Empty，新建一个空组件，命名为 Border，作为边界</p>
<p>导入一个矩形 Sprite, 这里导入 Sprite 的方式和 Unity 本体是一样的，就不多说明了</p>
<p>在 Border 下面 Create 2D Object -&gt; Sprite  </p>
<p>做4个边</p>
<p>给4个边加上 RigidBody2D 和 BoxCollider2D 来做物理效果</p>
<img src="/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/hierarchy.jpg" title="如图">
<p>刚体和碰撞检测的选项都比较简单</p>
<p>说一下刚体的几个 BodyType</p>
<ul>
<li>Static：静态，不做物理模拟，质量无限，不会同其他 static 和 kinematic 做碰撞检测</li>
<li>Kinematic：运动学，质量无限，运动靠 velocity，质量无限，所以不受力的作用，不会同其他 static 和 kinematic 做碰撞检测，移动靠设置他的 Position 或 velocity</li>
<li>Dynamic：动态，全物理模拟，和其他三种类型的刚体做碰撞检测，一般靠给其施加一个力来运动，当然也可以直接设置 velocity 和 Position 但是意义不大</li>
<li>BulletDynamic：子弹动态，和动态差不多，但是使用的连续碰撞检测，更精确，也更消耗资源，好处是不会因为速度过快而穿过其他刚体</li>
</ul>
<p>所以我们的边界选择什么很明显了-&gt; Static</p>
<p>其他几个参数：</p>
<ul>
<li>freezeRotation：如果 true 则不能旋转</li>
<li>friction：摩擦力，0 代表无摩擦，1 代表大摩擦，1 以上代表比 1 大的摩擦（废话）</li>
<li>restitution：弹性系数，0 代表完全吸收，1 代表完全反弹</li>
<li>density：密度，决定刚体的 质量 = 密度 * 体积</li>
</ul>
<p>这里我们选择全反弹 restitution 设置为 1</p>
<h3 id="自定义我们的产生器-spawner"><a href="#自定义我们的产生器-spawner" class="headerlink" title="自定义我们的产生器 spawner"></a>自定义我们的产生器 spawner</h3><p>我们自定义一个组件来产生小球</p>
<p>在 菜单 -&gt; Tiny -&gt; Component </p>
<p>新建一个 Spawner 组件</p>
<p>点击组件，在 inspector 中可以对其字段来做修改</p>
<p>如果 hide_flags 设置为 hide in inspectors 则在层级图中即使添加到实体上了也不会显示出来</p>
<p>add new field 可以添加任意可玩的数值和属性类型</p>
<p>点击属性名称可以修改之，下面可以设置默认值</p>
<p>最后设置如下</p>
<p>我们在延时 1.5s 后每 1.5s 创建一个 spawnedGroup 的实体 最多 maxCount 个</p>
<p>类型右边的 3 个图标分别是</p>
<ul>
<li>是否数组类型</li>
<li>编辑器是否可见：比如我们的 curCount 这个字段编辑器不可见，因为是不用编辑也不能编辑</li>
<li>子菜单 字面上的意思，Document 选项应该和自动生成文档的内容有关</li>
</ul>
<img src="/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/component_inspector.jpg" title="如图">
<p>生成器组件有了，我们继续来搞生成系统</p>
<p>菜单，创建 TypeScript System （后面省略哪里的菜单了哦）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** New System */</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> NewSystem <span class="keyword">extends</span> ut.ComponentSystem &#123;</span><br><span class="line">        </span><br><span class="line">        OnUpdate():<span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到生成了一个继承 ut.ComponentSystem 的类，重写一个 OnUpdate 函数</p>
<p>是不是和 Unity ECS 的方式一毛一样</p>
<p>ut 是 unity tiny 的简称</p>
<p>文件名修改为 SpawnSystem</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> SpawnSystem <span class="keyword">extends</span> ut.ComponentSystem &#123;</span><br><span class="line"></span><br><span class="line">        OnUpdate(): <span class="built_in">void</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.world.forEach([game.Spawner], <span class="function">(<span class="params">spawner</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (spawner.isPaused)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> time = spawner.time;</span><br><span class="line">                <span class="keyword">let</span> delay = spawner.delay;</span><br><span class="line"></span><br><span class="line">                time -= ut.Time.deltaTime();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (time &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    time += delay;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">"spawn"</span>);</span><br><span class="line">                    <span class="keyword">if</span> (spawner.curCount &lt; spawner.maxCount) &#123;</span><br><span class="line">                        ut.EntityGroup.instantiate(<span class="keyword">this</span>.world, spawner.spawnedGroup);</span><br><span class="line">                        spawner.curCount++</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                spawner.time = time;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码如上，循环 World 中的每一个 Spawner 来操作</p>
<p>至此，生成器组件完成，我们在 MainGroup 的 Spawn 元素的 insepector 中点击 Add Tiny Component 增加一个 Spawner 组件</p>
<p>于是就可以在编辑器中设置这个自定组件的值了</p>
<p>spawnedGroup 设置为 game.BallGroup</p>
<p>maxCount 设置为 10</p>
<hr>
<h2 id="创建球球实体"><a href="#创建球球实体" class="headerlink" title="创建球球实体"></a>创建球球实体</h2><p>创建新的实体组 名为 BallGroup</p>
<p>点击 Load 按钮</p>
<p>放到层级图中</p>
<p>加入一个 2d sprite UnitBall 如图</p>
<p>新建一个新的空组件 BallFlag 用来代表实体是球球</p>
<p>再增加 CircleCollider2D RigidBody2D 组件到球球</p>
<p>调整好圆形检测的半径</p>

<p>做好之后 Unload BallGroup，后面我们都通过 Spawner 来生成球球</p>
<h3 id="球球的行为"><a href="#球球的行为" class="headerlink" title="球球的行为"></a>球球的行为</h3><p>我们需要一个脚本来控制球球生成的地方，并且给一个力让他跑起来</p>
<p>菜单 创建 TypeScript Behavior</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> NewBehaviourFilter <span class="keyword">extends</span> ut.EntityFilter &#123;</span><br><span class="line">        node: ut.Core2D.TransformNode;</span><br><span class="line">        position?: ut.Core2D.TransformLocalPosition;</span><br><span class="line">        rotation?: ut.Core2D.TransformLocalRotation;</span><br><span class="line">        scale?: ut.Core2D.TransformLocalScale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> NewBehaviour <span class="keyword">extends</span> ut.ComponentBehaviour &#123;</span><br><span class="line"></span><br><span class="line">        data: NewBehaviourFilter;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ComponentBehaviour lifecycle events</span></span><br><span class="line">        <span class="comment">// uncomment any method you need</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// this method is called for each entity matching the NewBehaviourFilter signature, once when enabled</span></span><br><span class="line">        <span class="comment">//OnEntityEnable():void &#123; &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// this method is called for each entity matching the NewBehaviourFilter signature, every frame it's enabled</span></span><br><span class="line">        <span class="comment">//OnEntityUpdate():void &#123; &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// this method is called for each entity matching the NewBehaviourFilter signature, once when disabled</span></span><br><span class="line">        <span class="comment">//OnEntityDisable():void &#123; &#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>NewBehaviourFilter 相当于是 Unity ECS 中的 GetEntityGroup 中的 struct</p>
<p>将会获得有这个过滤器下字段的所有 Entity</p>
<p>所以我们需要给 UnitBall 增加一个 空的 BallFlag 来确认他是球球</p>
<ul>
<li>OnEntityEnable. Called only once, the first frame this entity is matched by this behaviour. 获得此Entity的第一帧执行</li>
<li>OnEntityUpdate. Called every frame on matching entities. </li>
<li>OnEntityDisable. Called only once, the first frame this entity is marked as disabled by this behaviour. 设置为 disable 的第一帧执行</li>
</ul>
<p>球球行为代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> BallBehaviorFilter <span class="keyword">extends</span> ut.EntityFilter &#123;</span><br><span class="line"></span><br><span class="line">        position: ut.Core2D.TransformLocalPosition;</span><br><span class="line">        entity: ut.Entity;</span><br><span class="line">        ball: game.BallFlag;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> BallBehavior <span class="keyword">extends</span> ut.ComponentBehaviour &#123;</span><br><span class="line"></span><br><span class="line">        data: BallBehaviorFilter;</span><br><span class="line"></span><br><span class="line">        OnEntityEnable(): <span class="built_in">void</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"ball Enabled"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 随机球球出现的位置</span></span><br><span class="line">            <span class="keyword">let</span> randomX = getRandom(<span class="number">-100</span>, <span class="number">100</span>)</span><br><span class="line">            <span class="keyword">let</span> randomY = getRandom(<span class="number">-100</span>, <span class="number">100</span>)</span><br><span class="line">            <span class="keyword">this</span>.data.position.position = <span class="keyword">new</span> Vector3(randomX, randomY, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 随机给球球一个力，动起来</span></span><br><span class="line">            <span class="comment">// 我们可以看到，这里用了 this.world.addComponentData 给球球添加了一个加力组件，这是一个特殊的组件</span></span><br><span class="line">            <span class="comment">// 这里的 AddImpulse2D 组件会在这一帧之后自动消失掉</span></span><br><span class="line">            <span class="keyword">let</span> impulse = <span class="keyword">new</span> ut.Physics2D.AddImpulse2D;</span><br><span class="line">            <span class="keyword">let</span> newImpulse = <span class="keyword">new</span> Vector2(getRandom(<span class="number">-1</span>, <span class="number">1</span>), getRandom(<span class="number">-1</span>, <span class="number">1</span>)).normalize();</span><br><span class="line">            impulse.impulse = <span class="keyword">new</span> Vector2(newImpulse.x * <span class="number">100</span>, newImpulse.y * <span class="number">100</span>);</span><br><span class="line">            <span class="keyword">this</span>.world.addComponentData(<span class="keyword">this</span>.data.entity, impulse);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"ball created:"</span> + <span class="keyword">this</span>.data.position.position);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        OnEntityUpdate(): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getRandom</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>) + min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>到此我们的工作告一段落，unity 执行后</p>
<p>会在我们的默认浏览器打开一个窗口</p>
<img src="/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/run_game.jpg" title="运行时 Unity 的 Game 窗口">
<p>在浏览器中使用开发者模式可以看到打印</p>
<p>也可以扫描二维码在移动设备上查看效果</p>
<p>运行效果如图</p>
<img src="/2018/12/10/Unity学习：ProjectTiny学习（二）弹球和2D物理/tiny_run.gif" title="运行">

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2018/12/10/Unity学习：ProjectTiny学习（一）初识Tiny模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/12/10/Unity学习：ProjectTiny学习（一）初识Tiny模式/" itemprop="url">
                  Unity学习：ProjectTiny学习（一）初识Tiny模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-10T11:10:56+08:00">
                2018-12-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/10/Unity学习：ProjectTiny学习（一）初识Tiny模式/" class="leancloud_visitors" data-flag-title="Unity学习：ProjectTiny学习（一）初识Tiny模式">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Project-Tiny-是什么？"><a href="#Project-Tiny-是什么？" class="headerlink" title="Project Tiny 是什么？"></a>Project Tiny 是什么？</h2><p>2018年12月，Unity在2018.3beta版本上开放了一个新包的预览下载，叫做ProjectTiny</p>
<p>并发布了一个基于此来制作的网页游戏</p>
<p><a href="https://blogs.unity3d.com/cn/2018/12/05/project-tiny-preview-package-is-here/" target="_blank" rel="noopener">原文Blog传送门</a></p>
<p><a href="https://tiny-match3.storage.googleapis.com/index.html" target="_blank" rel="noopener">Tiny Arms Revenge 游戏体验地址（需科学上网）</a></p>
<p>Project Tiny 的目的，是为更多即开即玩的游戏和互动广告提供支持</p>
<p>现在可以制作2D类型的Web游戏</p>
<p>体验游戏大小仅仅只有 1.8 MB，启动只需下载 969 KB</p>
<hr>
<h2 id="Project-Tiny-现在是什么情况，以后会怎么样？"><a href="#Project-Tiny-现在是什么情况，以后会怎么样？" class="headerlink" title="Project Tiny 现在是什么情况，以后会怎么样？"></a>Project Tiny 现在是什么情况，以后会怎么样？</h2><p>现在正在预览版本，只支持2D游戏，只支持TS语言，将来会支持C#，并移除TS支持，并且不断完善工具链和特性，并支持3D和AR体验</p>
<hr>
<h2 id="Project-Tiny-的特色和亮点？"><a href="#Project-Tiny-的特色和亮点？" class="headerlink" title="Project Tiny 的特色和亮点？"></a>Project Tiny 的特色和亮点？</h2><ul>
<li>纯的ECS模式，或许其编辑器可以看做未来Unity的ECS正式版编辑器的一个预览</li>
<li>ECS模式带来的效率提高</li>
<li>快速制作游戏和互动广告</li>
</ul>
<hr>
<h2 id="我的感觉"><a href="#我的感觉" class="headerlink" title="我的感觉"></a>我的感觉</h2><p>Project Tiny 顾名思义就是一个精干版本的 Unity 啦，用来制作 web 内容，并且其 ECS 模式很可能就是以后的 Unity ECS 模式的预览，学习 Project Tiny 对于我们进一步熟悉 Unity ECS 和提前熟悉新的编辑器都有好处</p>
<hr>
<h2 id="如何开始制作我们的第一个项目？"><a href="#如何开始制作我们的第一个项目？" class="headerlink" title="如何开始制作我们的第一个项目？"></a>如何开始制作我们的第一个项目？</h2><ol>
<li>下载 Unity 2018.3 Beta</li>
<li>打开 Windows -&gt; package manager</li>
<li>点击 Advanced，勾选 show preview packages </li>
<li>下载 Tiny Mode 包</li>
<li>菜单新增项目 Tiny，表示一切 OK</li>
<li>Tiny -&gt; File -&gt; NewProject 新建项目</li>
</ol>
<h2 id="例子项目在哪里？"><a href="#例子项目在哪里？" class="headerlink" title="例子项目在哪里？"></a>例子项目在哪里？</h2><p>菜单 Tiny -&gt; Import Samples 会加载例子到项目中</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2018/12/03/Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/12/03/Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动/" itemprop="url">
                  Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T15:53:23+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/03/Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动/" class="leancloud_visitors" data-flag-title="Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>Unity 2018 的新功能 ECS 现在已经放出了预览版本，我们现在就来尝试一下</p>
<p>—</p>
<h2 id="Hybrid模式"><a href="#Hybrid模式" class="headerlink" title="Hybrid模式"></a>Hybrid模式</h2><p>hybrid 就是混合模式，因为 Unity ECS 现在还只有预览版本</p>
<p>对 GameObject 和各种 Render 支持很差</p>
<p>所以混合模式可以看成现在的 GameObject 模式到纯 ECS 之间的过渡模式</p>
<p>Hybrid 模式下，并没有在效率上有非常大的提升</p>
<p>比起纯 ECS 模式</p>
<ul>
<li>初始化时间（遍历寻找Entity的过程）无法优化</li>
<li>载入时间无法优化</li>
<li>数据在内存中是随机获取的，非线性，执行效率下降</li>
<li>无法利用多核处理器</li>
<li>没有SIMD</li>
</ul>
<p>但是我们任然可以先尝试通过这种方式，来提高编程效率</p>
<p>并提前熟悉 Unity ECS 的思维模式</p>
<hr>
<h2 id="资源准备"><a href="#资源准备" class="headerlink" title="资源准备"></a>资源准备</h2><p>首先 导入了一组 星际争霸中刺蛇的 Sprite </p>
<p>先在 Sprite Editor 中切好了刺蛇的 走路 Sprite</p>
<p>做好了刺蛇16个方向走路的动作 Animation 和 Animator</p>
<p>Animator 增加参数 Direction Float 控制刺蛇的移动方向</p>
<p>总共 16 方向 做好从 AnyState 到每个方向的 Direction 条件</p>
<img src="/2018/12/03/Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动/unity_01.png" title="做好刺蛇的相关动作">
<p>我们不需要转换动画，所以 每个 translation 的 setting 里面的 duration 都改成 0</p>
<p>并且要把 Can translate to self 取消勾选，不然 永远会卡第一帧</p>
<hr>
<p>我们先通过简单的键盘操作来控制刺蛇移动</p>
<h2 id="设计我们的系统和实体"><a href="#设计我们的系统和实体" class="headerlink" title="设计我们的系统和实体"></a>设计我们的系统和实体</h2><h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><p>单位实体 Unit 包含的组件</p>
<ul>
<li>位置 Position</li>
<li>速度 Velocity </li>
<li>单位 Unit </li>
<li>输入 PlayerInput</li>
<li>可转向 Directable</li>
</ul>
<h3 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h3><h4 id="逻辑系统"><a href="#逻辑系统" class="headerlink" title="逻辑系统"></a>逻辑系统</h4><p>运动系统-需要</p>
<ul>
<li>位置 Position</li>
<li>速度 Velocity</li>
</ul>
<p>输入系统-需要 的组件</p>
<ul>
<li>输入 PlayerInput </li>
<li>速度 Velocity</li>
</ul>
<h4 id="同步-GameObject-状态的系统"><a href="#同步-GameObject-状态的系统" class="headerlink" title="同步 GameObject 状态的系统"></a>同步 GameObject 状态的系统</h4><p>同步 transform 系统</p>
<ul>
<li>位置 Position</li>
<li>Transform</li>
</ul>
<p>同步刺蛇 Animator 方向状态的系统</p>
<ul>
<li>速度 Velocity （速度控制朝向）</li>
<li>Animator</li>
</ul>
<hr>
<h2 id="编写上述组件和系统的代码"><a href="#编写上述组件和系统的代码" class="headerlink" title="编写上述组件和系统的代码"></a>编写上述组件和系统的代码</h2><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class Position2D : MonoBehaviour &#123;</span><br><span class="line">    // 位置 x y</span><br><span class="line">    public float2 Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerInput : MonoBehaviour &#123;</span><br><span class="line">    // 输入 x y</span><br><span class="line">    public float2 Move;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="可转向"><a href="#可转向" class="headerlink" title="可转向"></a>可转向</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Directable : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Unit : MonoBehaviour &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="速度"><a href="#速度" class="headerlink" title="速度"></a>速度</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class Velocity : MonoBehaviour &#123;</span><br><span class="line">    // 速度 x y</span><br><span class="line">    public float2 Value;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大家可以看到我们这边都是继承的 MonoBehavior ，有的还是一些空的类</p>
<p>继承 MonoBehavior 才能被添加到 GameObject 中,至于空类的作用我们下面在讲系统的时候来讲</p>
<h3 id="系统-1"><a href="#系统-1" class="headerlink" title="系统"></a>系统</h3><p>ECS 中的 S 意为 System 就是系统了，系统的做法，下面已经比较清楚了</p>
<p>在系统中 可以通过 GetEntities 来自动获得声明好的 结构体数据</p>
<p>结构体数据是从哪里获得的呢？</p>
<p>答案是从游戏中所有的 Entity 来自动获取，由于我们使用的是一个 GameObject ，要获得这个 GameObject 的数据，需要在这个 GameObject 中添加一个内置脚本 GameObjectEntity</p>
<p>表示我们这个 GameObject 是一个 Entity 了</p>
<p>那么大家可能也就知道上面那些空类的作用了</p>
<p>假如我们不对 GameObject 添加 Directable 脚本的话</p>
<p>就无法被 SyncAnimatorDirectionSystem（见下方代码） 中的 GetEntities<data> 来获得</data></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetEntities &lt;T&gt;</span><br></pre></td></tr></table></figure>
<p> 的作用就是获取含有 T 中所有字段类型的 所有 Entity</p>
<p>System 可以使用 UpdateAfter 或者 UpdateBefore 来控制其执行顺序</p>
<h4 id="输入-1"><a href="#输入-1" class="headerlink" title="输入"></a>输入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class PlayerInputSystem : ComponentSystem &#123;</span><br><span class="line">    struct PlayerData &#123;</span><br><span class="line"></span><br><span class="line">        public PlayerInput Input;</span><br><span class="line">        public Velocity Velocity;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        float dt = Time.deltaTime;</span><br><span class="line"></span><br><span class="line">        foreach (var entity in GetEntities&lt;PlayerData&gt; ()) &#123;</span><br><span class="line">            var pi = entity.Input;</span><br><span class="line"></span><br><span class="line">            pi.Move.x = Input.GetAxis (&quot;Horizontal&quot;);</span><br><span class="line">            pi.Move.y = Input.GetAxis (&quot;Vertical&quot;);</span><br><span class="line"></span><br><span class="line">            entity.Velocity.Value = new float2 (pi.Move.x, pi.Move.y);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class UnitMoveSystem : ComponentSystem &#123;</span><br><span class="line">    struct MoveUnit &#123;</span><br><span class="line"></span><br><span class="line">        public Position2D Position;</span><br><span class="line"></span><br><span class="line">        public Velocity MoveSpeed;</span><br><span class="line"></span><br><span class="line">        public Unit unit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        var dt = Time.deltaTime;</span><br><span class="line">        foreach (var entity in GetEntities&lt;MoveUnit&gt; ()) &#123;</span><br><span class="line">            var pos = entity.Position;</span><br><span class="line">            pos.Value += entity.MoveSpeed.Value * dt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="同步位置"><a href="#同步位置" class="headerlink" title="同步位置"></a>同步位置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Collections;</span><br><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">[UpdateAfter (typeof (UnitMoveSystem))]</span><br><span class="line">public class SyncTransformSystem : ComponentSystem &#123;</span><br><span class="line">    public struct Data &#123;</span><br><span class="line"></span><br><span class="line">        [ReadOnly] public Position2D Position;</span><br><span class="line"></span><br><span class="line">        public Transform Output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        foreach (var entity in GetEntities&lt;Data&gt; ()) &#123;</span><br><span class="line">            float2 p = entity.Position.Value;</span><br><span class="line">            entity.Output.position = new float3 (p.x, p.y, 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<h4 id="同步动画朝向状态"><a href="#同步动画朝向状态" class="headerlink" title="同步动画朝向状态"></a>同步动画朝向状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Collections;</span><br><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">[UpdateAfter (typeof (PlayerInputSystem))]</span><br><span class="line">public class SyncAnimatorDirectionSystem : ComponentSystem &#123;</span><br><span class="line"></span><br><span class="line">    public struct Data &#123;</span><br><span class="line"></span><br><span class="line">        [ReadOnly] public Velocity moveSpeed;</span><br><span class="line"></span><br><span class="line">        public Animator Output;</span><br><span class="line"></span><br><span class="line">        public Directable directable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        foreach (var entity in GetEntities&lt;Data&gt; ()) &#123;</span><br><span class="line"></span><br><span class="line">            float2 p = entity.moveSpeed.Value;</span><br><span class="line"></span><br><span class="line">            var angle = Mathf.Atan2 (p.x, p.y) * Mathf.Rad2Deg;</span><br><span class="line">            if (angle &lt; 0) &#123;</span><br><span class="line">                angle = 360 + angle;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            entity.Output.SetFloat (&quot;Direction&quot;, angle);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 刺蛇的 Prefab 下添加需要的组件脚本</p>
<p>如下图</p>

<p>加载刺蛇预制体,这里使用 Lua 加载的</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> go = UnityEngine.GameObject.Instantiate(prefab)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>按 wasd 来操作刺蛇移动</p>
<img src="/2018/12/03/Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动/unity_03.gif" title="刺蛇可以移动了">

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2018/12/03/Unity学习：切割Sprite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/12/03/Unity学习：切割Sprite/" itemprop="url">
                  Unity学习：切割Sprite
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-03T11:22:55+08:00">
                2018-12-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/12/03/Unity学习：切割Sprite/" class="leancloud_visitors" data-flag-title="Unity学习：切割Sprite">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>很多2D老资源是打好成一张图的，我们需要去切成一个一个的sprite</p>
<p>这时候导入图片后，材质类型选择 Sprite and UI ， Sprite 类型选择 Mutiple</p>
<p>然后打开 Sprite Editor，自己切就可以了</p>
<p>Sprite Editor 里面选择 Slice 切片</p>
<p>如果图片中有框，选择 自动切应该就 OK</p>
<p>否则还有按 大小切 和 按个数来切</p>
<p>切完之后 点击每个片片，可以手动再修改一下</p>
<hr>
<h2 id="使用脚本来处理每个切片"><a href="#使用脚本来处理每个切片" class="headerlink" title="使用脚本来处理每个切片"></a>使用脚本来处理每个切片</h2><p>我们导入的素材每个sprite有个小黑框，这个小黑框我们不要，怎么办呢？</p>
<p>每个手动去重新校正太麻烦，自己写个Editor脚本来解决吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEditor;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class SpriteCustomScrips : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">	[MenuItem (&quot;Sprites/Rect small by 1&quot;)]</span><br><span class="line">	static void SpritesSmallBy1 () &#123;</span><br><span class="line">		// Debug.Log (Selection.</span><br><span class="line"></span><br><span class="line">		string path = AssetDatabase.GetAssetPath (Selection.activeObject);</span><br><span class="line">		Debug.Log (path);</span><br><span class="line"></span><br><span class="line">		TextureImporter ti = AssetImporter.GetAtPath (path) as TextureImporter;</span><br><span class="line">		SpriteMetaData[] spriteSheet = ti.spritesheet;</span><br><span class="line">		for (int i = 0; i &lt; spriteSheet.Length; i++) &#123;</span><br><span class="line"></span><br><span class="line">			if (spriteSheet[i].name.StartsWith (&quot;Hydra_walk_&quot;)) &#123;</span><br><span class="line">				spriteSheet[i].rect = new Rect (spriteSheet[i].rect.x + 1, spriteSheet[i].rect.y + 1, spriteSheet[i].rect.width - 2, spriteSheet[i].rect.height - 2);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ti.spritesheet = spriteSheet;</span><br><span class="line">		EditorUtility.SetDirty (ti);</span><br><span class="line">		ti.SaveAndReimport ();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的脚本大家可以参考一下，修改了一下sprite的rect</p>
<p>然后我们在project视图中选中刚才自动切好的资源，点击菜单处理一下，发现1px的小黑框没有了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://Mapz.github.io/2018/11/30/Unity学习：UGUI按钮的导航属性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/link-300x300.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/11/30/Unity学习：UGUI按钮的导航属性/" itemprop="url">
                  Unity学习：UGUI按钮的导航属性
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-30T11:16:35+08:00">
                2018-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/11/30/Unity学习：UGUI按钮的导航属性/" class="leancloud_visitors" data-flag-title="Unity学习：UGUI按钮的导航属性">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>UGUI 中的按钮有4个状态，包括 Normal highlighted pressed disabled</p>
<p>而导航属性可以决定这几个状态之间的切换</p>
<p>如果选中了导航属性，则按钮在点击后，会进入选中状态，表现为highlighted, 鼠标移出，也不会回复normal状态</p>
<p>类似于老式录音机的 按下 或者说 单选组 状态，需要按其他的按钮才能回到 normal 状态</p>
<p>所以我们搞单个按钮的时候 应当把按钮的导航关闭</p>
<hr>
<p>导航的另外一个功能，就是UI按钮的切换高光顺序</p>
<p>类似于我们在UI上按 tab 按键 切换选中的元素一样</p>
<p>至于导航的几个选项，就是字面上的意思啦</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/link-300x300.gif"
               alt="Mapz" />
          <p class="site-author-name" itemprop="name">Mapz</p>
           
              <p class="site-description motion-element" itemprop="description">FIND THE CHILD</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Mapz" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mapz</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("r1k7xXPTo8S7UTzLv0ny4XLz-gzGzoHsz", "3QFN4XJbJvVAywXDtWKYeUV4");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
