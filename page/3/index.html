<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/link-300x300.gif">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/link-300x300.gif">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/link-300x300.gif">
  <link rel="mask-icon" href="/images/link-300x300.gif" color="#222">
  <link rel="manifest" href="/images/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mapz.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="FIND THE CHILD">
<meta property="og:type" content="website">
<meta property="og:title" content="Mapz&#39;s Blog">
<meta property="og:url" content="http://mapz.github.io/page/3/index.html">
<meta property="og:site_name" content="Mapz&#39;s Blog">
<meta property="og:description" content="FIND THE CHILD">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mapz">
<meta property="article:tag" content="游戏开发,UE4">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://mapz.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Mapz's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?69c67c43ced4b46e7ba1656a83e9c872";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Mapz's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">可以递归的函数指针</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/12/11/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E7%8E%B0%E7%8A%B6%EF%BC%88%E5%8D%B3%E6%97%B6%E6%9B%B4%E6%96%B0%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/11/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E7%8E%B0%E7%8A%B6%EF%BC%88%E5%8D%B3%E6%97%B6%E6%9B%B4%E6%96%B0%EF%BC%89/" class="post-title-link" itemprop="url">Unity学习：ProjectTiny现状（即时更新）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-11 15:33:34" itemprop="dateCreated datePublished" datetime="2018-12-11T15:33:34+08:00">2018-12-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="TileMap"><a href="#TileMap" class="headerlink" title="TileMap"></a>TileMap</h2><ul>
<li>可以编辑，可以使用，但是现在无物理特性（Platform游戏可以先等等），不能设置碰撞</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B9%E7%90%83%E5%92%8C2D%E7%89%A9%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B9%E7%90%83%E5%92%8C2D%E7%89%A9%E7%90%86/" class="post-title-link" itemprop="url">Unity学习：ProjectTiny学习（二）弹球和2D物理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-10 14:40:38" itemprop="dateCreated datePublished" datetime="2018-12-10T14:40:38+08:00">2018-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 18:01:14" itemprop="dateModified" datetime="2021-04-23T18:01:14+08:00">2021-04-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>接着上次我们继续来玩 Tiny Mode</p>
<h2 id="创建一个新项目"><a href="#创建一个新项目" class="headerlink" title="创建一个新项目"></a>创建一个新项目</h2><p>菜单 -&gt; tiny -&gt; file -&gt; new project </p>
<p>创建新的项目 TinyNew</p>
<p>我们可以看到，在 Asset 目录下创建了一个新的名为 TinyNew 的目录</p>
<p>下面有一个 TinyNew.utproject 文件</p>
<p>这个文件就是 tiny mode 的项目文件了</p>
<p>和 Unity 不同，tiny mode 不存在 Scene </p>
<p>双击项目文件，就可以加载项目了</p>
<p>项目的 Inspector 如图</p>


<p>可以选择 Build 类型，需要加载的模块</p>
<p>还有显示设置以及物理设置</p>
<p>从可加载的模块看我们现在基本也可以知道 Tiny Mode 现有的功能有哪些</p>
<p>物理选项只有一个重力，可以看出相比 Unity 本体非常的精简</p>
<p>我们要做的是平面上球触边弹的效果，所以重力设置为 0</p>
<hr>
<h2 id="开始创建主实体"><a href="#开始创建主实体" class="headerlink" title="开始创建主实体"></a>开始创建主实体</h2><p>以前我们的各种玩意，都是放在 GameObject 上的，在 ECS 中，GameObject 没有了，用来放内容的变成了 Entity，所以还是老一套，需要一个 Entity 来放置摄像机什么的</p>
<p>创建一个新的 Entity 现阶段只能从 Tiny 菜单 Create EntityGroup 或者层级图中，点击 Create EntityGroup</p>
<p>我们在 Entities 目录下新建一个 MainGroup，点击后</p>
<p>在 EntityGroup 的 Inspector 中可以看到两个按钮</p>


<ul>
<li>Load: 加载这个组的一个 Entity 实例到层级图中，方便操作</li>
<li>Set as StartUp: 设置为初始 Group，游戏启动时，会自动加载，不能被 Unload</li>
</ul>
<p>我们把 MainGroup 设置为启动加载</p>
<p>在 MainGroup 右边的小菜单里面选择 Camera 新增一个 Camera</p>
<p>再 Create Empty，新建一个空组件，命名为 Spawner，用来产生球球</p>
<p>再 Create Empty，新建一个空组件，命名为 Border，作为边界</p>
<p>导入一个矩形 Sprite, 这里导入 Sprite 的方式和 Unity 本体是一样的，就不多说明了</p>
<p>在 Border 下面 Create 2D Object -&gt; Sprite  </p>
<p>做4个边</p>
<p>给4个边加上 RigidBody2D 和 BoxCollider2D 来做物理效果</p>
<img src="/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B9%E7%90%83%E5%92%8C2D%E7%89%A9%E7%90%86/hierarchy.jpg" class="" title="如图">

<p>刚体和碰撞检测的选项都比较简单</p>
<p>说一下刚体的几个 BodyType</p>
<ul>
<li>Static：静态，不做物理模拟，质量无限，不会同其他 static 和 kinematic 做碰撞检测</li>
<li>Kinematic：运动学，质量无限，运动靠 velocity，质量无限，所以不受力的作用，不会同其他 static 和 kinematic 做碰撞检测，移动靠设置他的 Position 或 velocity</li>
<li>Dynamic：动态，全物理模拟，和其他三种类型的刚体做碰撞检测，一般靠给其施加一个力来运动，当然也可以直接设置 velocity 和 Position 但是意义不大</li>
<li>BulletDynamic：子弹动态，和动态差不多，但是使用的连续碰撞检测，更精确，也更消耗资源，好处是不会因为速度过快而穿过其他刚体</li>
</ul>
<p>所以我们的边界选择什么很明显了-&gt; Static</p>
<p>其他几个参数：</p>
<ul>
<li>freezeRotation：如果 true 则不能旋转</li>
<li>friction：摩擦力，0 代表无摩擦，1 代表大摩擦，1 以上代表比 1 大的摩擦（废话）</li>
<li>restitution：弹性系数，0 代表完全吸收，1 代表完全反弹</li>
<li>density：密度，决定刚体的 质量 = 密度 * 体积</li>
</ul>
<p>这里我们选择全反弹 restitution 设置为 1</p>
<h3 id="自定义我们的产生器-spawner"><a href="#自定义我们的产生器-spawner" class="headerlink" title="自定义我们的产生器 spawner"></a>自定义我们的产生器 spawner</h3><p>我们自定义一个组件来产生小球</p>
<p>在 菜单 -&gt; Tiny -&gt; Component </p>
<p>新建一个 Spawner 组件</p>
<p>点击组件，在 inspector 中可以对其字段来做修改</p>
<p>如果 hide_flags 设置为 hide in inspectors 则在层级图中即使添加到实体上了也不会显示出来</p>
<p>add new field 可以添加任意可玩的数值和属性类型</p>
<p>点击属性名称可以修改之，下面可以设置默认值</p>
<p>最后设置如下</p>
<p>我们在延时 1.5s 后每 1.5s 创建一个 spawnedGroup 的实体 最多 maxCount 个</p>
<p>类型右边的 3 个图标分别是</p>
<ul>
<li>是否数组类型</li>
<li>编辑器是否可见：比如我们的 curCount 这个字段编辑器不可见，因为是不用编辑也不能编辑</li>
<li>子菜单 字面上的意思，Document 选项应该和自动生成文档的内容有关</li>
</ul>
<img src="/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B9%E7%90%83%E5%92%8C2D%E7%89%A9%E7%90%86/component_inspector.jpg" class="" title="如图">

<p>生成器组件有了，我们继续来搞生成系统</p>
<p>菜单，创建 TypeScript System （后面省略哪里的菜单了哦）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** New System */</span></span><br><span class="line">    <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">NewSystem</span> <span class="keyword">extends</span> <span class="title">ut</span>.<span class="title">ComponentSystem</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        OnUpdate():<span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们可以看到生成了一个继承 ut.ComponentSystem 的类，重写一个 OnUpdate 函数</p>
<p>是不是和 Unity ECS 的方式一毛一样</p>
<p>ut 是 unity tiny 的简称</p>
<p>文件名修改为 SpawnSystem</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">SpawnSystem</span> <span class="keyword">extends</span> <span class="title">ut</span>.<span class="title">ComponentSystem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        OnUpdate(): <span class="built_in">void</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.world.forEach([game.Spawner], <span class="function">(<span class="params">spawner</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (spawner.isPaused)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">let</span> time = spawner.time;</span><br><span class="line">                <span class="keyword">let</span> delay = spawner.delay;</span><br><span class="line"></span><br><span class="line">                time -= ut.Time.deltaTime();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (time &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    time += delay;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;spawn&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (spawner.curCount &lt; spawner.maxCount) &#123;</span><br><span class="line">                        ut.EntityGroup.instantiate(<span class="built_in">this</span>.world, spawner.spawnedGroup);</span><br><span class="line">                        spawner.curCount++</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                spawner.time = time;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码如上，循环 World 中的每一个 Spawner 来操作</p>
<p>至此，生成器组件完成，我们在 MainGroup 的 Spawn 元素的 insepector 中点击 Add Tiny Component 增加一个 Spawner 组件</p>
<p>于是就可以在编辑器中设置这个自定组件的值了</p>
<p>spawnedGroup 设置为 game.BallGroup</p>
<p>maxCount 设置为 10</p>
<hr>
<h2 id="创建球球实体"><a href="#创建球球实体" class="headerlink" title="创建球球实体"></a>创建球球实体</h2><p>创建新的实体组 名为 BallGroup</p>
<p>点击 Load 按钮</p>
<p>放到层级图中</p>
<p>加入一个 2d sprite UnitBall 如图</p>
<p>新建一个新的空组件 BallFlag 用来代表实体是球球</p>
<p>再增加 CircleCollider2D RigidBody2D 组件到球球</p>
<p>调整好圆形检测的半径</p>


<p>做好之后 Unload BallGroup，后面我们都通过 Spawner 来生成球球</p>
<h3 id="球球的行为"><a href="#球球的行为" class="headerlink" title="球球的行为"></a>球球的行为</h3><p>我们需要一个脚本来控制球球生成的地方，并且给一个力让他跑起来</p>
<p>菜单 创建 TypeScript Behavior</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">NewBehaviourFilter</span> <span class="keyword">extends</span> <span class="title">ut</span>.<span class="title">EntityFilter</span> </span>&#123;</span><br><span class="line">        <span class="attr">node</span>: ut.Core2D.TransformNode;</span><br><span class="line">        position?: ut.Core2D.TransformLocalPosition;</span><br><span class="line">        rotation?: ut.Core2D.TransformLocalRotation;</span><br><span class="line">        scale?: ut.Core2D.TransformLocalScale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">NewBehaviour</span> <span class="keyword">extends</span> <span class="title">ut</span>.<span class="title">ComponentBehaviour</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">data</span>: NewBehaviourFilter;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ComponentBehaviour lifecycle events</span></span><br><span class="line">        <span class="comment">// uncomment any method you need</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// this method is called for each entity matching the NewBehaviourFilter signature, once when enabled</span></span><br><span class="line">        <span class="comment">//OnEntityEnable():void &#123; &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// this method is called for each entity matching the NewBehaviourFilter signature, every frame it&#x27;s enabled</span></span><br><span class="line">        <span class="comment">//OnEntityUpdate():void &#123; &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// this method is called for each entity matching the NewBehaviourFilter signature, once when disabled</span></span><br><span class="line">        <span class="comment">//OnEntityDisable():void &#123; &#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>NewBehaviourFilter 相当于是 Unity ECS 中的 GetEntityGroup 中的 struct</p>
<p>将会获得有这个过滤器下字段的所有 Entity</p>
<p>所以我们需要给 UnitBall 增加一个 空的 BallFlag 来确认他是球球</p>
<ul>
<li>OnEntityEnable. Called only once, the first frame this entity is matched by this behaviour. 获得此Entity的第一帧执行</li>
<li>OnEntityUpdate. Called every frame on matching entities. </li>
<li>OnEntityDisable. Called only once, the first frame this entity is marked as disabled by this behaviour. 设置为 disable 的第一帧执行</li>
</ul>
<p>球球行为代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> game &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BallBehaviorFilter</span> <span class="keyword">extends</span> <span class="title">ut</span>.<span class="title">EntityFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">position</span>: ut.Core2D.TransformLocalPosition;</span><br><span class="line">        entity: ut.Entity;</span><br><span class="line">        ball: game.BallFlag;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">BallBehavior</span> <span class="keyword">extends</span> <span class="title">ut</span>.<span class="title">ComponentBehaviour</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">data</span>: BallBehaviorFilter;</span><br><span class="line"></span><br><span class="line">        OnEntityEnable(): <span class="built_in">void</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ball Enabled&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 随机球球出现的位置</span></span><br><span class="line">            <span class="keyword">let</span> randomX = getRandom(-<span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">            <span class="keyword">let</span> randomY = getRandom(-<span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">            <span class="built_in">this</span>.data.position.position = <span class="keyword">new</span> Vector3(randomX, randomY, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 随机给球球一个力，动起来</span></span><br><span class="line">            <span class="comment">// 我们可以看到，这里用了 this.world.addComponentData 给球球添加了一个加力组件，这是一个特殊的组件</span></span><br><span class="line">            <span class="comment">// 这里的 AddImpulse2D 组件会在这一帧之后自动消失掉</span></span><br><span class="line">            <span class="keyword">let</span> impulse = <span class="keyword">new</span> ut.Physics2D.AddImpulse2D;</span><br><span class="line">            <span class="keyword">let</span> newImpulse = <span class="keyword">new</span> Vector2(getRandom(-<span class="number">1</span>, <span class="number">1</span>), getRandom(-<span class="number">1</span>, <span class="number">1</span>)).normalize();</span><br><span class="line">            impulse.impulse = <span class="keyword">new</span> Vector2(newImpulse.x * <span class="number">100</span>, newImpulse.y * <span class="number">100</span>);</span><br><span class="line">            <span class="built_in">this</span>.world.addComponentData(<span class="built_in">this</span>.data.entity, impulse);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;ball created:&quot;</span> + <span class="built_in">this</span>.data.position.position);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        OnEntityUpdate(): <span class="built_in">void</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getRandom</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>) + min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>到此我们的工作告一段落，unity 执行后</p>
<p>会在我们的默认浏览器打开一个窗口</p>
<img src="/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B9%E7%90%83%E5%92%8C2D%E7%89%A9%E7%90%86/run_game.jpg" class="" title="运行时 Unity 的 Game 窗口">

<p>在浏览器中使用开发者模式可以看到打印</p>
<p>也可以扫描二维码在移动设备上查看效果</p>
<p>运行效果如图</p>
<img src="/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B9%E7%90%83%E5%92%8C2D%E7%89%A9%E7%90%86/tiny_run.gif" class="" title="运行">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E8%AF%86Tiny%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/10/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AProjectTiny%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89%E5%88%9D%E8%AF%86Tiny%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Unity学习：ProjectTiny学习（一）初识Tiny模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-10 11:10:56" itemprop="dateCreated datePublished" datetime="2018-12-10T11:10:56+08:00">2018-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Project-Tiny-是什么？"><a href="#Project-Tiny-是什么？" class="headerlink" title="Project Tiny 是什么？"></a>Project Tiny 是什么？</h2><p>2018年12月，Unity在2018.3beta版本上开放了一个新包的预览下载，叫做ProjectTiny</p>
<p>并发布了一个基于此来制作的网页游戏</p>
<p><a target="_blank" rel="noopener" href="https://blogs.unity3d.com/cn/2018/12/05/project-tiny-preview-package-is-here/">原文Blog传送门</a></p>
<p><a target="_blank" rel="noopener" href="https://tiny-match3.storage.googleapis.com/index.html">Tiny Arms Revenge 游戏体验地址（需科学上网）</a></p>
<p>Project Tiny 的目的，是为更多即开即玩的游戏和互动广告提供支持</p>
<p>现在可以制作2D类型的Web游戏</p>
<p>体验游戏大小仅仅只有 1.8 MB，启动只需下载 969 KB</p>
<hr>
<h2 id="Project-Tiny-现在是什么情况，以后会怎么样？"><a href="#Project-Tiny-现在是什么情况，以后会怎么样？" class="headerlink" title="Project Tiny 现在是什么情况，以后会怎么样？"></a>Project Tiny 现在是什么情况，以后会怎么样？</h2><p>现在正在预览版本，只支持2D游戏，只支持TS语言，将来会支持C#，并移除TS支持，并且不断完善工具链和特性，并支持3D和AR体验</p>
<hr>
<h2 id="Project-Tiny-的特色和亮点？"><a href="#Project-Tiny-的特色和亮点？" class="headerlink" title="Project Tiny 的特色和亮点？"></a>Project Tiny 的特色和亮点？</h2><ul>
<li>纯的ECS模式，或许其编辑器可以看做未来Unity的ECS正式版编辑器的一个预览</li>
<li>ECS模式带来的效率提高</li>
<li>快速制作游戏和互动广告</li>
</ul>
<hr>
<h2 id="我的感觉"><a href="#我的感觉" class="headerlink" title="我的感觉"></a>我的感觉</h2><p>Project Tiny 顾名思义就是一个精干版本的 Unity 啦，用来制作 web 内容，并且其 ECS 模式很可能就是以后的 Unity ECS 模式的预览，学习 Project Tiny 对于我们进一步熟悉 Unity ECS 和提前熟悉新的编辑器都有好处</p>
<hr>
<h2 id="如何开始制作我们的第一个项目？"><a href="#如何开始制作我们的第一个项目？" class="headerlink" title="如何开始制作我们的第一个项目？"></a>如何开始制作我们的第一个项目？</h2><ol>
<li>下载 Unity 2018.3 Beta</li>
<li>打开 Windows -&gt; package manager</li>
<li>点击 Advanced，勾选 show preview packages </li>
<li>下载 Tiny Mode 包</li>
<li>菜单新增项目 Tiny，表示一切 OK</li>
<li>Tiny -&gt; File -&gt; NewProject 新建项目</li>
</ol>
<h2 id="例子项目在哪里？"><a href="#例子项目在哪里？" class="headerlink" title="例子项目在哪里？"></a>例子项目在哪里？</h2><p>菜单 Tiny -&gt; Import Samples 会加载例子到项目中</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/12/03/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AECS%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Hybrid%E6%A8%A1%E5%BC%8FECS%E6%8E%A7%E5%88%B6%E5%88%BA%E8%9B%87%E7%A7%BB%E5%8A%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/03/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AECS%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Hybrid%E6%A8%A1%E5%BC%8FECS%E6%8E%A7%E5%88%B6%E5%88%BA%E8%9B%87%E7%A7%BB%E5%8A%A8/" class="post-title-link" itemprop="url">Unity学习：ECS学习（一）Hybrid模式ECS控制刺蛇移动</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-03 15:53:23" itemprop="dateCreated datePublished" datetime="2018-12-03T15:53:23+08:00">2018-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Unity 2018 的新功能 ECS 现在已经放出了预览版本，我们现在就来尝试一下</p>
<p>—</p>
<h2 id="Hybrid模式"><a href="#Hybrid模式" class="headerlink" title="Hybrid模式"></a>Hybrid模式</h2><p>hybrid 就是混合模式，因为 Unity ECS 现在还只有预览版本</p>
<p>对 GameObject 和各种 Render 支持很差</p>
<p>所以混合模式可以看成现在的 GameObject 模式到纯 ECS 之间的过渡模式</p>
<p>Hybrid 模式下，并没有在效率上有非常大的提升</p>
<p>比起纯 ECS 模式</p>
<ul>
<li>初始化时间（遍历寻找Entity的过程）无法优化</li>
<li>载入时间无法优化</li>
<li>数据在内存中是随机获取的，非线性，执行效率下降</li>
<li>无法利用多核处理器</li>
<li>没有SIMD</li>
</ul>
<p>但是我们任然可以先尝试通过这种方式，来提高编程效率</p>
<p>并提前熟悉 Unity ECS 的思维模式</p>
<hr>
<h2 id="资源准备"><a href="#资源准备" class="headerlink" title="资源准备"></a>资源准备</h2><p>首先 导入了一组 星际争霸中刺蛇的 Sprite </p>
<p>先在 Sprite Editor 中切好了刺蛇的 走路 Sprite</p>
<p>做好了刺蛇16个方向走路的动作 Animation 和 Animator</p>
<p>Animator 增加参数 Direction Float 控制刺蛇的移动方向</p>
<p>总共 16 方向 做好从 AnyState 到每个方向的 Direction 条件</p>
<img src="/2018/12/03/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AECS%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Hybrid%E6%A8%A1%E5%BC%8FECS%E6%8E%A7%E5%88%B6%E5%88%BA%E8%9B%87%E7%A7%BB%E5%8A%A8/unity_01.png" class="" title="做好刺蛇的相关动作">

<p>我们不需要转换动画，所以 每个 translation 的 setting 里面的 duration 都改成 0</p>
<p>并且要把 Can translate to self 取消勾选，不然 永远会卡第一帧</p>
<hr>
<p>我们先通过简单的键盘操作来控制刺蛇移动</p>
<h2 id="设计我们的系统和实体"><a href="#设计我们的系统和实体" class="headerlink" title="设计我们的系统和实体"></a>设计我们的系统和实体</h2><h3 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h3><p>单位实体 Unit 包含的组件</p>
<ul>
<li>位置 Position</li>
<li>速度 Velocity </li>
<li>单位 Unit </li>
<li>输入 PlayerInput</li>
<li>可转向 Directable</li>
</ul>
<h3 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h3><h4 id="逻辑系统"><a href="#逻辑系统" class="headerlink" title="逻辑系统"></a>逻辑系统</h4><p>运动系统-需要</p>
<ul>
<li>位置 Position</li>
<li>速度 Velocity</li>
</ul>
<p>输入系统-需要 的组件</p>
<ul>
<li>输入 PlayerInput </li>
<li>速度 Velocity</li>
</ul>
<h4 id="同步-GameObject-状态的系统"><a href="#同步-GameObject-状态的系统" class="headerlink" title="同步 GameObject 状态的系统"></a>同步 GameObject 状态的系统</h4><p>同步 transform 系统</p>
<ul>
<li>位置 Position</li>
<li>Transform</li>
</ul>
<p>同步刺蛇 Animator 方向状态的系统</p>
<ul>
<li>速度 Velocity （速度控制朝向）</li>
<li>Animator</li>
</ul>
<hr>
<h2 id="编写上述组件和系统的代码"><a href="#编写上述组件和系统的代码" class="headerlink" title="编写上述组件和系统的代码"></a>编写上述组件和系统的代码</h2><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class Position2D : MonoBehaviour &#123;</span><br><span class="line">    // 位置 x y</span><br><span class="line">    public float2 Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerInput : MonoBehaviour &#123;</span><br><span class="line">    // 输入 x y</span><br><span class="line">    public float2 Move;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="可转向"><a href="#可转向" class="headerlink" title="可转向"></a>可转向</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Directable : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Unit : MonoBehaviour &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="速度"><a href="#速度" class="headerlink" title="速度"></a>速度</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class Velocity : MonoBehaviour &#123;</span><br><span class="line">    // 速度 x y</span><br><span class="line">    public float2 Value;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大家可以看到我们这边都是继承的 MonoBehavior ，有的还是一些空的类</p>
<p>继承 MonoBehavior 才能被添加到 GameObject 中,至于空类的作用我们下面在讲系统的时候来讲</p>
<h3 id="系统-1"><a href="#系统-1" class="headerlink" title="系统"></a>系统</h3><p>ECS 中的 S 意为 System 就是系统了，系统的做法，下面已经比较清楚了</p>
<p>在系统中 可以通过 GetEntities 来自动获得声明好的 结构体数据</p>
<p>结构体数据是从哪里获得的呢？</p>
<p>答案是从游戏中所有的 Entity 来自动获取，由于我们使用的是一个 GameObject ，要获得这个 GameObject 的数据，需要在这个 GameObject 中添加一个内置脚本 GameObjectEntity</p>
<p>表示我们这个 GameObject 是一个 Entity 了</p>
<p>那么大家可能也就知道上面那些空类的作用了</p>
<p>假如我们不对 GameObject 添加 Directable 脚本的话</p>
<p>就无法被 SyncAnimatorDirectionSystem（见下方代码） 中的 GetEntities<Data> 来获得</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetEntities &lt;T&gt;</span><br></pre></td></tr></table></figure>
<p> 的作用就是获取含有 T 中所有字段类型的 所有 Entity</p>
<p>System 可以使用 UpdateAfter 或者 UpdateBefore 来控制其执行顺序</p>
<h4 id="输入-1"><a href="#输入-1" class="headerlink" title="输入"></a>输入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class PlayerInputSystem : ComponentSystem &#123;</span><br><span class="line">    struct PlayerData &#123;</span><br><span class="line"></span><br><span class="line">        public PlayerInput Input;</span><br><span class="line">        public Velocity Velocity;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        float dt = Time.deltaTime;</span><br><span class="line"></span><br><span class="line">        foreach (var entity in GetEntities&lt;PlayerData&gt; ()) &#123;</span><br><span class="line">            var pi = entity.Input;</span><br><span class="line"></span><br><span class="line">            pi.Move.x = Input.GetAxis (&quot;Horizontal&quot;);</span><br><span class="line">            pi.Move.y = Input.GetAxis (&quot;Vertical&quot;);</span><br><span class="line"></span><br><span class="line">            entity.Velocity.Value = new float2 (pi.Move.x, pi.Move.y);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class UnitMoveSystem : ComponentSystem &#123;</span><br><span class="line">    struct MoveUnit &#123;</span><br><span class="line"></span><br><span class="line">        public Position2D Position;</span><br><span class="line"></span><br><span class="line">        public Velocity MoveSpeed;</span><br><span class="line"></span><br><span class="line">        public Unit unit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        var dt = Time.deltaTime;</span><br><span class="line">        foreach (var entity in GetEntities&lt;MoveUnit&gt; ()) &#123;</span><br><span class="line">            var pos = entity.Position;</span><br><span class="line">            pos.Value += entity.MoveSpeed.Value * dt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="同步位置"><a href="#同步位置" class="headerlink" title="同步位置"></a>同步位置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">using Unity.Collections;</span><br><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">[UpdateAfter (typeof (UnitMoveSystem))]</span><br><span class="line">public class SyncTransformSystem : ComponentSystem &#123;</span><br><span class="line">    public struct Data &#123;</span><br><span class="line"></span><br><span class="line">        [ReadOnly] public Position2D Position;</span><br><span class="line"></span><br><span class="line">        public Transform Output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        foreach (var entity in GetEntities&lt;Data&gt; ()) &#123;</span><br><span class="line">            float2 p = entity.Position.Value;</span><br><span class="line">            entity.Output.position = new float3 (p.x, p.y, 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">#### 同步动画朝向状态</span><br><span class="line">```` C#</span><br><span class="line">using Unity.Collections;</span><br><span class="line">using Unity.Entities;</span><br><span class="line">using Unity.Mathematics;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">[UpdateAfter (typeof (PlayerInputSystem))]</span><br><span class="line">public class SyncAnimatorDirectionSystem : ComponentSystem &#123;</span><br><span class="line"></span><br><span class="line">    public struct Data &#123;</span><br><span class="line"></span><br><span class="line">        [ReadOnly] public Velocity moveSpeed;</span><br><span class="line"></span><br><span class="line">        public Animator Output;</span><br><span class="line"></span><br><span class="line">        public Directable directable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override void OnUpdate () &#123;</span><br><span class="line">        foreach (var entity in GetEntities&lt;Data&gt; ()) &#123;</span><br><span class="line"></span><br><span class="line">            float2 p = entity.moveSpeed.Value;</span><br><span class="line"></span><br><span class="line">            var angle = Mathf.Atan2 (p.x, p.y) * Mathf.Rad2Deg;</span><br><span class="line">            if (angle &lt; 0) &#123;</span><br><span class="line">                angle = 360 + angle;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            entity.Output.SetFloat (&quot;Direction&quot;, angle);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">然后在 刺蛇的 Prefab 下添加需要的组件脚本</span><br><span class="line"></span><br><span class="line">如下图</span><br><span class="line"></span><br><span class="line">&#123;% asset_img unity_02.png 刺蛇预制体的脚本添加 %&#125;</span><br><span class="line"></span><br><span class="line">加载刺蛇预制体,这里使用 Lua 加载的</span><br><span class="line"></span><br><span class="line">``` Lua</span><br><span class="line">     local go = UnityEngine.GameObject.Instantiate(prefab)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>按 wasd 来操作刺蛇移动</p>
<img src="/2018/12/03/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AECS%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Hybrid%E6%A8%A1%E5%BC%8FECS%E6%8E%A7%E5%88%B6%E5%88%BA%E8%9B%87%E7%A7%BB%E5%8A%A8/unity_03.gif" class="" title="刺蛇可以移动了">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/12/03/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9A%E5%88%87%E5%89%B2Sprite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/03/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9A%E5%88%87%E5%89%B2Sprite/" class="post-title-link" itemprop="url">Unity学习：切割Sprite</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-03 11:22:55" itemprop="dateCreated datePublished" datetime="2018-12-03T11:22:55+08:00">2018-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>很多2D老资源是打好成一张图的，我们需要去切成一个一个的sprite</p>
<p>这时候导入图片后，材质类型选择 Sprite and UI ， Sprite 类型选择 Mutiple</p>
<p>然后打开 Sprite Editor，自己切就可以了</p>
<p>Sprite Editor 里面选择 Slice 切片</p>
<p>如果图片中有框，选择 自动切应该就 OK</p>
<p>否则还有按 大小切 和 按个数来切</p>
<p>切完之后 点击每个片片，可以手动再修改一下</p>
<hr>
<h2 id="使用脚本来处理每个切片"><a href="#使用脚本来处理每个切片" class="headerlink" title="使用脚本来处理每个切片"></a>使用脚本来处理每个切片</h2><p>我们导入的素材每个sprite有个小黑框，这个小黑框我们不要，怎么办呢？</p>
<p>每个手动去重新校正太麻烦，自己写个Editor脚本来解决吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEditor;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class SpriteCustomScrips : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">	[MenuItem (&quot;Sprites/Rect small by 1&quot;)]</span><br><span class="line">	static void SpritesSmallBy1 () &#123;</span><br><span class="line">		// Debug.Log (Selection.</span><br><span class="line"></span><br><span class="line">		string path = AssetDatabase.GetAssetPath (Selection.activeObject);</span><br><span class="line">		Debug.Log (path);</span><br><span class="line"></span><br><span class="line">		TextureImporter ti = AssetImporter.GetAtPath (path) as TextureImporter;</span><br><span class="line">		SpriteMetaData[] spriteSheet = ti.spritesheet;</span><br><span class="line">		for (int i = 0; i &lt; spriteSheet.Length; i++) &#123;</span><br><span class="line"></span><br><span class="line">			if (spriteSheet[i].name.StartsWith (&quot;Hydra_walk_&quot;)) &#123;</span><br><span class="line">				spriteSheet[i].rect = new Rect (spriteSheet[i].rect.x + 1, spriteSheet[i].rect.y + 1, spriteSheet[i].rect.width - 2, spriteSheet[i].rect.height - 2);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ti.spritesheet = spriteSheet;</span><br><span class="line">		EditorUtility.SetDirty (ti);</span><br><span class="line">		ti.SaveAndReimport ();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的脚本大家可以参考一下，修改了一下sprite的rect</p>
<p>然后我们在project视图中选中刚才自动切好的资源，点击菜单处理一下，发现1px的小黑框没有了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/11/30/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AUGUI%E6%8C%89%E9%92%AE%E7%9A%84%E5%AF%BC%E8%88%AA%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/30/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AUGUI%E6%8C%89%E9%92%AE%E7%9A%84%E5%AF%BC%E8%88%AA%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">Unity学习：UGUI按钮的导航属性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-30 11:16:35" itemprop="dateCreated datePublished" datetime="2018-11-30T11:16:35+08:00">2018-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>UGUI 中的按钮有4个状态，包括 Normal highlighted pressed disabled</p>
<p>而导航属性可以决定这几个状态之间的切换</p>
<p>如果选中了导航属性，则按钮在点击后，会进入选中状态，表现为highlighted, 鼠标移出，也不会回复normal状态</p>
<p>类似于老式录音机的 按下 或者说 单选组 状态，需要按其他的按钮才能回到 normal 状态</p>
<p>所以我们搞单个按钮的时候 应当把按钮的导航关闭</p>
<hr>
<p>导航的另外一个功能，就是UI按钮的切换高光顺序</p>
<p>类似于我们在UI上按 tab 按键 切换选中的元素一样</p>
<p>至于导航的几个选项，就是字面上的意思啦</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/01/31/%E4%BD%BF%E7%94%A8Node%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/31/%E4%BD%BF%E7%94%A8Node%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">使用Node搭建静态文件服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-31 12:22:55" itemprop="dateCreated datePublished" datetime="2018-01-31T12:22:55+08:00">2018-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Mac 更新系统后原来机器上的 apache 配置丢失，我又不想去重新配置 apache 的虚拟目录和虚拟服务器</p>
<p>对付下测试环境的文件资源服务器，用 Node 还是挺方便的，那么步骤如下</p>
<hr>
<p><strong>需求 : Node 环境已经装好</strong></p>
<p>作为一个资深API调试员，使用开源库</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cloudhead/node-static">https://github.com/cloudhead/node-static</a></p>
<p>使用命令行安装之</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g node-static</span><br></pre></td></tr></table></figure>

<p>然后编写 Node 脚本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> port = <span class="number">8080</span>;</span><br><span class="line"><span class="keyword">var</span> doc_root = <span class="string">&quot;/server_root&quot;</span> <span class="comment">//文件服根目录</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;node-static&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileServer = <span class="keyword">new</span> <span class="keyword">static</span>.Server(doc_root);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    request.addListener(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fileServer.serve(request, response);</span><br><span class="line">    &#125;).resume();</span><br><span class="line">&#125;).listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure>


<p>启动 Node 脚本</p>
<h1 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/01/17/%E5%AF%BC%E5%87%BA%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%E6%96%87%E6%9C%AC%E4%B8%BAPNG/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/17/%E5%AF%BC%E5%87%BA%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%E6%96%87%E6%9C%AC%E4%B8%BAPNG/" class="post-title-link" itemprop="url">导出字体文件文本为PNG</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-17 16:19:04" itemprop="dateCreated datePublished" datetime="2018-01-17T16:19:04+08:00">2018-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有时候我们需要从字体文件中直接提取文字并导出成PNG格式</p>
<p>经过Google后找到可以用 ImageMagick 来搞</p>
<p>以下方式都在 Mac 下测试通过，Windows也可以，但安装方式稍有不同</p>
<hr>
<h2 id="下载-MacPorts"><a href="#下载-MacPorts" class="headerlink" title="下载 MacPorts"></a>下载 MacPorts</h2><p>应该是和 homebrew 类似的一个安装工具</p>
<p>安好后经可以使用命令行来获取 ImageMagick</p>
<p><a target="_blank" rel="noopener" href="https://www.macports.org/install.php">点我去下载</a></p>
<p>注意看自己的 macOS 版本</p>
<h2 id="安装-ImageMagick"><a href="#安装-ImageMagick" class="headerlink" title="安装 ImageMagick"></a>安装 ImageMagick</h2><p>安好 MacPorts 后</p>
<p>命令行获取即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo port install ImageMagick</span><br></pre></td></tr></table></figure>

<p>也可以用源码直接安装，参考 <a target="_blank" rel="noopener" href="http://www.imagemagick.org/script/download.php">这里</a></p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -background none -fill black -font 方正像素12.TTF -pointsize 300 label:<span class="string">&quot;主&quot;</span> 主.png</span><br></pre></td></tr></table></figure>

<hr>
<p>详情参考</p>
<p><a target="_blank" rel="noopener" href="http://www.imagemagick.org/script/download.php">这里</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/12/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89Vue2%20ElementUI%E9%A1%B5%E9%9D%A2%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/12/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89Vue2%20ElementUI%E9%A1%B5%E9%9D%A2%E5%88%B6%E4%BD%9C/" class="post-title-link" itemprop="url">Django项目开发（四）Vue2 ElementUI页面制作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-12 10:22:19" itemprop="dateCreated datePublished" datetime="2017-05-12T10:22:19+08:00">2017-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a href="">Mapz的blog</a></p>
<p>前文目录：</p>
<ol>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Django项目的搭建</a></li>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">Django项目开发（一）</a></li>
<li><a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/">Django项目开发（二）View层</a></li>
<li><a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/">Django项目开发（三）结合Vue</a></li>
</ol>
<p>前文讲了我们怎么把vue和django结合起来，这次我们讲讲vue的基本开发</p>
<h2 id="初见Vue"><a href="#初见Vue" class="headerlink" title="初见Vue"></a>初见Vue</h2><h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>假设我们已经知道了css html 和 JavaScript 基础，那 Vue 对你来说肯定不是难事，他的简单易用性可以快速上手</p>
<p>我们查看我们之前生成的单页应用的src目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── App.vue <span class="comment"># 入口vue组件</span></span><br><span class="line">├── assets <span class="comment"># 资源目录</span></span><br><span class="line">│   └── logo.png </span><br><span class="line">├── components <span class="comment"># 组件目录</span></span><br><span class="line">│   └── Hello.vue <span class="comment"># 组件</span></span><br><span class="line">├── main.js <span class="comment"># 启动代码</span></span><br><span class="line">└── router <span class="comment"># 路由</span></span><br><span class="line">    └── index.js </span><br></pre></td></tr></table></figure>

<p>.vue 文件是 vue 的基本组成形式，一个文件代表一个组件</p>
<p>其中 template 区域表示本组件的模版， script 区是代码区 type 标签里面则是样式声明</p>
<p>type 可以使用多种样式表语言 css less 什么的都可以（需要安装相关支持）</p>
<p>我们再看App.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">name</span>: <span class="string">&#x27;app&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span></span><br><span class="line"><span class="css"><span class="xml"><span class="selector-id">#app</span> &#123;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">font-family</span>: <span class="string">&#x27;Avenir&#x27;</span>, Helvetica, Arial, sans-serif;</span></span></span><br><span class="line"><span class="css"><span class="xml">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span></span></span><br><span class="line"><span class="css"><span class="xml">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">color</span>: <span class="number">#2c3e50</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">margin-top</span>: <span class="number">60px</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="css"><span class="xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>那么这个组件是怎么变成入口的呢</p>
<p>可以看外面的index.html</p>
<p>中间有个 id=app 的div</p>
<p>在 main.js 中有这么一段</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;App/&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123; App &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里的 el 就是这个 vue 实例要挂载的元素<br>template 是用来挂在的模版<br>components 是用来挂在的内容，也就是我们的 App.vue</p>
<p>这样App.vue的内容就自动注入到index.html中了</p>
<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>前面我们讲了，Vue 的特点之一是数据双向绑定，也就是说展示的内容和模型的内容是绑定的，同步的，修改一个，另一个就会一起变化，Vue在实现这个功能的时候，为了将所有数据都收归 Vue 来管理，所以数据的声明必须由 Vue 来操作</p>
<p>我们移步hello.vue</p>
<p>在代码块中有个 data() 函数，这个函数里面就是声明我们的数据区，在这里面声明的内容，Vue会自动给他加上 getter和setter，这个过程对使用者来说事透明的，你不会注意到她，当一个数据读取或者变化的时候，就会调用setter和getter，从而触发 Vue 对绑定这个数据的内容的刷新，所以我们的数据块，都在 data() 区声明，是很重要的</p>
<p>另外，data() 返回的不是一个数据实例，而是一个返回数据副本的函数，这个很重要</p>
<p>为什么呢，因为我们知道 Vue 的组件是可以复用的，所以每次都要返回单独的数据实例呀，否则不是成了相当于 Java 中 static 数据的东西了吗</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;Welcome to Your Vue.js App&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们看到，我们声明的数据，在写模版的时候用双层引号来渲染</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>我们的App.vue是怎么显示出hello.vue组件的内容的呢</p>
<p>我们看到 app 的模版中 有个 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个标签会自动渲染路由的内容</p>
<p>在 main.js 中我们引入了路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在router的index.js中我们看到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&#x27;@/components/Hello&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="comment">//配置访问路径</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Hello&#x27;</span>, <span class="comment">//配置路径“页面”名称</span></span><br><span class="line">      <span class="attr">component</span>: Hello <span class="comment">//配置要渲染的组件</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用了vue-router工具来做路由</p>
<p>导出了一个路由配置</p>
<p>所以我们在访问路径/的时候，Hello.vue就渲染在了 router-view 上</p>
<hr>
<h2 id="安装vue-admin"><a href="#安装vue-admin" class="headerlink" title="安装vue-admin"></a>安装vue-admin</h2><p><a target="_blank" rel="noopener" href="http://element.eleme.io/#/zh-CN/component/quickstart">ElementUI文档</a></p>
<p>ElementUI是饿了吗弄的一个模版，适合来做管理工具的前端</p>
<p>我们这里就直接使用一个基于elementui的开源模版vue-admin来开发</p>
<p>开发的时候又问题随时参考文档</p>
<p><a target="_blank" rel="noopener" href="https://github.com/taylorchen709/vue-admin">vue-admin</a></p>
<p>下载下来</p>
<p>删掉 frontend 目录里面的所有内容，然后把下载下来的 vue-admin 内容解压 copy 进去</p>
<p>然后在 frontend 中执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>因为里面有安装node-sass</p>
<p>如果安装出错了，可以先安装这个东西(支持一种css加强语法的工具)，加上镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SASS_BINARY_SITE=https://npm.taobao.org/mirrors/node-sass/ npm install node-sass</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm build</span><br></pre></td></tr></table></figure>

<p>我们还需要修改webpack中的一个参数让导出的静态调用地址适配 django中 的设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br></pre></td></tr></table></figure>

<p>打开 vue 项目中的webpack.config.js文件</p>
<p>修改为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assetsRoot: path.resolve(__dirname, <span class="string">&#x27;../dist/static&#x27;</span>),</span><br><span class="line"><span class="attr">assetsSubDirectory</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">assetsPublicPath</span>: <span class="string">&#x27;/static/&#x27;</span>,</span><br></pre></td></tr></table></figure>

<p>这样webpack导出的内容中的static的东西，都会以/static/的url前缀去调用，和django中一样了</p>
<p>访问 django 的站点 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/">http://127.0.0.1:8000/qk_deploy/</a></p>
<p>和 vue 的测试站点 <a target="_blank" rel="noopener" href="http://127.0.0.1:8010/">http://127.0.0.1:8010/</a></p>
<p>现在都可以正确访问我们的内容了</p>
<p>但是为了不每次访问的时候都打包，所以一般我们用 vue 的测试站点来进行测试</p>
<hr>
<h2 id="对接API：登陆"><a href="#对接API：登陆" class="headerlink" title="对接API：登陆"></a>对接API：登陆</h2><p>我们可以看到 vue-admin 里面使用的是 axios 作为 Ajax 库</p>
<p>作为示范，作者使用 mock 来制作了假数据</p>
<p>我们屏蔽掉 mock 开始接入我们写好的 django 登陆 api</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改 main.js 屏蔽mock</span></span><br><span class="line"><span class="comment">// import Mock from &#x27;./mock&#x27;</span></span><br><span class="line"><span class="comment">// Mock.bootstrap();</span></span><br></pre></td></tr></table></figure>

<p>修改 api.js,设置为我们的接口地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let base = &#x27;&#x27;;</span></span><br><span class="line"><span class="keyword">let</span> base = <span class="string">&#x27;http://127.0.0.1:8000/qk_deploy/api&#x27;</span></span><br></pre></td></tr></table></figure>

<p>访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/#/login">http://127.0.0.1:8080/#/login</a></p>
<p>测试登陆</p>
<p>我们已经可以请求登陆啦~~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/" class="post-title-link" itemprop="url">Django项目开发（三）结合Vue</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-10 17:20:49" itemprop="dateCreated datePublished" datetime="2017-05-10T17:20:49+08:00">2017-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/">Mapz的blog</a></p>
<p>前文目录：</p>
<ol>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Django项目的搭建</a></li>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">Django项目开发（一）</a></li>
<li><a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/">Django项目开发（二）View层</a></li>
</ol>
<p>前面我们介绍了Django的一些基本安装和使用</p>
<p>因为我们项目将会使用前后端分离的技术来处理，所以我们将会放弃使用Django的View层来处理业务逻辑，而只是用Django做ORM和API接口，并使用 Vue.js 2 来制作前端页面</p>
<hr>
<h2 id="Vue-js-简介"><a href="#Vue-js-简介" class="headerlink" title="Vue.js 简介"></a>Vue.js 简介</h2><h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p>Vue 采用 MVVM 的模式，MVVM 是 MVC 的衍生物</p>
<p>他和 MVC 的区别在哪儿呢</p>
<p>在 MVVM 中 C 变成了 VM</p>
<p>在 MVC 中用户可以直接操作 C 层 或是通过 V 层来操作 Model</p>
<p>C 层一般只有路由的作用 而 V 层则承载了大量的业务逻辑，非常臃肿</p>
<p>而在 MVVM 中 View 和 Model 之间不再直接发生关系了</p>
<p>View 层也不在有任何业务逻辑，他是真的只作为展示层来使用</p>
<p>逻辑去了哪儿呢？答案是 VM 层，就是 ModelView</p>
<p>然后为什么说 MVVM 可以方便的实现数据和逻辑分离呢</p>
<p>关键在 VM 层和 M 层是双向绑定的</p>
<p>也就是说，我在 VM 层经过逻辑处理的数据，会自动表现在 View 层上，也会自动改变 Model 层中的数据</p>
<p>于是我们的数据、逻辑和渲染，就完全分开了</p>
<p>简而言之：</p>
<p><strong>我只需要修改好我的业务逻辑，配置好数据，写好模版，所有的一切就可以自动呈现和更新了</strong> </p>
<p>业务逻辑，数据和展示真正做到了分离</p>
<h3 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h3><p>Vue React Angular 都是最近比较流行的前端框架</p>
<p>数据的双向绑定，响应式和组件化 都是他们的思维要点</p>
<p>Vue 相比另两个，优点是学习成本低，性能高，并且虽然比不上另外两个，但任然有着比较丰富的生态</p>
<p>另外 Vue 还有他的原生兄弟 Weex</p>
<p>Weex 是阿里的跨平台用户界面开发框架，他兼容 Vue 的语法</p>
<p>也就是说 </p>
<p><strong>学会 Vue 之后，你也可以让你的代码跑上 iOS 和 Android</strong></p>
<p>当然啦，React 也有对应的 ReactNative 来做原生应用</p>
<hr>
<h2 id="集成-Vue-到-Django-中"><a href="#集成-Vue-到-Django-中" class="headerlink" title="集成 Vue 到 Django 中"></a>集成 Vue 到 Django 中</h2><p>我们假定你的机器上已经装好了</p>
<ul>
<li>Node.js 4+</li>
<li>npm 3+</li>
<li>Python 2.7+</li>
</ul>
<p>以下安装需要基于上述环境</p>
<h3 id="安装-vue-cli"><a href="#安装-vue-cli" class="headerlink" title="安装 vue-cli"></a>安装 vue-cli</h3><p>vue 一般使用 vue-cli 来初始化我们的项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-cli -g --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>-g 的意思是全局安装</p>
<p>–registry 参数是镜像，我们在国内一般用淘宝的镜像比较快</p>
<h3 id="创建-vue-项目"><a href="#创建-vue-项目" class="headerlink" title="创建 vue 项目"></a>创建 vue 项目</h3><p>回到我们的django项目的目录下，用vue-cli 创建一个项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-init webpack frontend</span><br></pre></td></tr></table></figure>

<p>其中 frontend 是我们的 vue 工程目录名称</p>
<p>中间的参数是我们要用到的模版</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>这个命令可以导出webpack输出，简单说就是web工程打包</p>
<p>build 好的内容导出 dist 目录下，也就是我们django中要用到的内容了</p>
<h3 id="Django下的配置"><a href="#Django下的配置" class="headerlink" title="Django下的配置"></a>Django下的配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># settings.py 需要加载模版，所以要修改我们的模版目录加上dist目录</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [<span class="string">&#x27;frontend/dist/&#x27;</span>],</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让Django能去dist下寻找静态文件</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&quot;frontend/dist/static&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># qk_deploy/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将我们的文件直接作为模版引入</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^$&#x27;</span>, TemplateView.as_view(template_name=<span class="string">&quot;index.html&quot;</span>))</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们现在访问</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/#/">http://127.0.0.1:8000/qk_deploy/#/</a></p>
<p>应该可以看到 vue 的欢迎页面了</p>
<h3 id="搭建调试环境"><a href="#搭建调试环境" class="headerlink" title="搭建调试环境"></a>搭建调试环境</h3><p>如果我们使用 Django的环境来进行测试呢，也就会导致，每次修改了vue项目的文件都要重新build，这样太慢了</p>
<p>vue.js的开发环境会自动检查文件变化来重新构建，是比较方便的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>会启动vue的开发环境，但这样有个问题，使用vue的开发环境，就是脱离了Django的开发环境了，访问Django上的API出现了跨域问题</p>
<p>为了能让我们快乐的调试呢，我们使用Django的第三方插件django-cors-headers来解决跨域问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">MIDDLEWARE_CLASSES = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>, <span class="comment">#注意顺序不能变</span></span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span> <span class="comment">#添加这个配置</span></span><br></pre></td></tr></table></figure>

<h3 id="Django-配置-RESTful-API"><a href="#Django-配置-RESTful-API" class="headerlink" title="Django 配置 RESTful API"></a>Django 配置 RESTful API</h3><p>不用Django的后端渲染了，我们使用RESTful API作为前后端交流的工具</p>
<h4 id="安装-djangorestframework"><a href="#安装-djangorestframework" class="headerlink" title="安装 djangorestframework "></a>安装 djangorestframework </h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br><span class="line">pip install markdown -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br><span class="line">pip install django-filter -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br></pre></td></tr></table></figure>

<p>这里我们和 npm 安装东西的时候一样，使用了镜像，不然下载的太慢了啦 pip 使用镜像用-i参数<br>对于不是https的地址，必须用 –trusted-host 才能继续</p>
<p>装好后</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">INSTALLED_APPS = (</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目根目录下 url.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r&#x27;^api-auth/&#x27;</span>, include(<span class="string">&#x27;rest_framework.urls&#x27;</span>, namespace=<span class="string">&#x27;rest_framework&#x27;</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="创建model和serializer"><a href="#创建model和serializer" class="headerlink" title="创建model和serializer"></a>创建model和serializer</h4><p>我们这里将用用户登陆为例，来看怎么写和使用API</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions,status</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BasicAuthentication</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserLogin</span>(<span class="params">generics.CreateAPIView</span>):</span></span><br><span class="line">    permission_classes = (permissions.AllowAny,)</span><br><span class="line">    serializer_class = LoginSerializer</span><br><span class="line">    authentication_classes = (BasicAuthentication,) <span class="comment">#这里一定要是 BasicAuthentication，否则会出现CSRF问题，因为我们现在是登陆，登录前么有在session中用CSRF，这个问题我们后面来说</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(username)</span><br><span class="line">            password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(password)</span><br><span class="line">            user = User.objects.get(username__iexact=username)</span><br><span class="line">            <span class="built_in">print</span>(user)</span><br><span class="line">            <span class="keyword">if</span> user.check_password(password):</span><br><span class="line">                serializer = LoginSerializer(&#123;<span class="string">&#x27;id&#x27;</span>: user.<span class="built_in">id</span>, <span class="string">&#x27;username&#x27;</span>: user.username&#125;)</span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_401_UNAUTHORIZED)</span><br><span class="line">        <span class="keyword">except</span> User.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_401_UNAUTHORIZED)</span><br></pre></td></tr></table></figure>

<p>创建我们的登陆view<br><br>创建serializers.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line"></span><br><span class="line">    username = serializers.CharField(required=<span class="literal">False</span>, max_length=<span class="number">1024</span>)</span><br><span class="line">    password = serializers.CharField(required=<span class="literal">False</span>, max_length=<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = User</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>urls.py中加上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r&#x27;^api/login$&#x27;</span>, UserLogin.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>访问</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/api/login">http://127.0.0.1:8000/qk_deploy/api/login</a></p>
<p>可以看到 restful_framework的测试界面</p>
<p>在界面测试API</p>
<p>用已有的用户登陆，已经可以看到正确的回应了，否则会返回状态401</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mapz"
      src="/images/link-300x300.gif">
  <p class="site-author-name" itemprop="name">Mapz</p>
  <div class="site-description" itemprop="description">FIND THE CHILD</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Mapz" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Mapz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">true</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

</body>
</html>
