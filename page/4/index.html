<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/link-300x300.gif">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/link-300x300.gif">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/link-300x300.gif">
  <link rel="mask-icon" href="/images/link-300x300.gif" color="#222">
  <link rel="manifest" href="/images/manifest.json">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mapz.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="FIND THE CHILD">
<meta property="og:type" content="website">
<meta property="og:title" content="Mapz&#39;s Blog">
<meta property="og:url" content="http://mapz.github.io/page/4/index.html">
<meta property="og:site_name" content="Mapz&#39;s Blog">
<meta property="og:description" content="FIND THE CHILD">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mapz">
<meta property="article:tag" content="游戏开发,UE4">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://mapz.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Mapz's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?69c67c43ced4b46e7ba1656a83e9c872";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Mapz's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">可以递归的函数指针</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/11/30/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AUGUI%E6%8C%89%E9%92%AE%E7%9A%84%E5%AF%BC%E8%88%AA%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/30/Unity%E5%AD%A6%E4%B9%A0%EF%BC%9AUGUI%E6%8C%89%E9%92%AE%E7%9A%84%E5%AF%BC%E8%88%AA%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">Unity学习：UGUI按钮的导航属性</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-30 11:16:35" itemprop="dateCreated datePublished" datetime="2018-11-30T11:16:35+08:00">2018-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>UGUI 中的按钮有4个状态，包括 Normal highlighted pressed disabled</p>
<p>而导航属性可以决定这几个状态之间的切换</p>
<p>如果选中了导航属性，则按钮在点击后，会进入选中状态，表现为highlighted, 鼠标移出，也不会回复normal状态</p>
<p>类似于老式录音机的 按下 或者说 单选组 状态，需要按其他的按钮才能回到 normal 状态</p>
<p>所以我们搞单个按钮的时候 应当把按钮的导航关闭</p>
<hr>
<p>导航的另外一个功能，就是UI按钮的切换高光顺序</p>
<p>类似于我们在UI上按 tab 按键 切换选中的元素一样</p>
<p>至于导航的几个选项，就是字面上的意思啦</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/01/31/%E4%BD%BF%E7%94%A8Node%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/31/%E4%BD%BF%E7%94%A8Node%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">使用Node搭建静态文件服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-31 12:22:55" itemprop="dateCreated datePublished" datetime="2018-01-31T12:22:55+08:00">2018-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Mac 更新系统后原来机器上的 apache 配置丢失，我又不想去重新配置 apache 的虚拟目录和虚拟服务器</p>
<p>对付下测试环境的文件资源服务器，用 Node 还是挺方便的，那么步骤如下</p>
<hr>
<p><strong>需求 : Node 环境已经装好</strong></p>
<p>作为一个资深API调试员，使用开源库</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cloudhead/node-static">https://github.com/cloudhead/node-static</a></p>
<p>使用命令行安装之</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g node-static</span><br></pre></td></tr></table></figure>

<p>然后编写 Node 脚本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> port = <span class="number">8080</span>;</span><br><span class="line"><span class="keyword">var</span> doc_root = <span class="string">&quot;/server_root&quot;</span> <span class="comment">//文件服根目录</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;node-static&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fileServer = <span class="keyword">new</span> <span class="keyword">static</span>.Server(doc_root);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    request.addListener(<span class="string">&#x27;end&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        fileServer.serve(request, response);</span><br><span class="line">    &#125;).resume();</span><br><span class="line">&#125;).listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure>


<p>启动 Node 脚本</p>
<h1 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2018/01/17/%E5%AF%BC%E5%87%BA%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%E6%96%87%E6%9C%AC%E4%B8%BAPNG/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/17/%E5%AF%BC%E5%87%BA%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%E6%96%87%E6%9C%AC%E4%B8%BAPNG/" class="post-title-link" itemprop="url">导出字体文件文本为PNG</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-17 16:19:04" itemprop="dateCreated datePublished" datetime="2018-01-17T16:19:04+08:00">2018-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有时候我们需要从字体文件中直接提取文字并导出成PNG格式</p>
<p>经过Google后找到可以用 ImageMagick 来搞</p>
<p>以下方式都在 Mac 下测试通过，Windows也可以，但安装方式稍有不同</p>
<hr>
<h2 id="下载-MacPorts"><a href="#下载-MacPorts" class="headerlink" title="下载 MacPorts"></a>下载 MacPorts</h2><p>应该是和 homebrew 类似的一个安装工具</p>
<p>安好后经可以使用命令行来获取 ImageMagick</p>
<p><a target="_blank" rel="noopener" href="https://www.macports.org/install.php">点我去下载</a></p>
<p>注意看自己的 macOS 版本</p>
<h2 id="安装-ImageMagick"><a href="#安装-ImageMagick" class="headerlink" title="安装 ImageMagick"></a>安装 ImageMagick</h2><p>安好 MacPorts 后</p>
<p>命令行获取即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo port install ImageMagick</span><br></pre></td></tr></table></figure>

<p>也可以用源码直接安装，参考 <a target="_blank" rel="noopener" href="http://www.imagemagick.org/script/download.php">这里</a></p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert -background none -fill black -font 方正像素12.TTF -pointsize 300 label:<span class="string">&quot;主&quot;</span> 主.png</span><br></pre></td></tr></table></figure>

<hr>
<p>详情参考</p>
<p><a target="_blank" rel="noopener" href="http://www.imagemagick.org/script/download.php">这里</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/12/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89Vue2%20ElementUI%E9%A1%B5%E9%9D%A2%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/12/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E5%9B%9B%EF%BC%89Vue2%20ElementUI%E9%A1%B5%E9%9D%A2%E5%88%B6%E4%BD%9C/" class="post-title-link" itemprop="url">Django项目开发（四）Vue2 ElementUI页面制作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-12 10:22:19" itemprop="dateCreated datePublished" datetime="2017-05-12T10:22:19+08:00">2017-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a href="">Mapz的blog</a></p>
<p>前文目录：</p>
<ol>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Django项目的搭建</a></li>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">Django项目开发（一）</a></li>
<li><a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/">Django项目开发（二）View层</a></li>
<li><a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/">Django项目开发（三）结合Vue</a></li>
</ol>
<p>前文讲了我们怎么把vue和django结合起来，这次我们讲讲vue的基本开发</p>
<h2 id="初见Vue"><a href="#初见Vue" class="headerlink" title="初见Vue"></a>初见Vue</h2><h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p>假设我们已经知道了css html 和 JavaScript 基础，那 Vue 对你来说肯定不是难事，他的简单易用性可以快速上手</p>
<p>我们查看我们之前生成的单页应用的src目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── App.vue <span class="comment"># 入口vue组件</span></span><br><span class="line">├── assets <span class="comment"># 资源目录</span></span><br><span class="line">│   └── logo.png </span><br><span class="line">├── components <span class="comment"># 组件目录</span></span><br><span class="line">│   └── Hello.vue <span class="comment"># 组件</span></span><br><span class="line">├── main.js <span class="comment"># 启动代码</span></span><br><span class="line">└── router <span class="comment"># 路由</span></span><br><span class="line">    └── index.js </span><br></pre></td></tr></table></figure>

<p>.vue 文件是 vue 的基本组成形式，一个文件代表一个组件</p>
<p>其中 template 区域表示本组件的模版， script 区是代码区 type 标签里面则是样式声明</p>
<p>type 可以使用多种样式表语言 css less 什么的都可以（需要安装相关支持）</p>
<p>我们再看App.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">name</span>: <span class="string">&#x27;app&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span></span><br><span class="line"><span class="css"><span class="xml"><span class="selector-id">#app</span> &#123;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">font-family</span>: <span class="string">&#x27;Avenir&#x27;</span>, Helvetica, Arial, sans-serif;</span></span></span><br><span class="line"><span class="css"><span class="xml">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span></span></span><br><span class="line"><span class="css"><span class="xml">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">color</span>: <span class="number">#2c3e50</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">  <span class="attribute">margin-top</span>: <span class="number">60px</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">&#125;</span></span></span><br><span class="line"><span class="css"><span class="xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>那么这个组件是怎么变成入口的呢</p>
<p>可以看外面的index.html</p>
<p>中间有个 id=app 的div</p>
<p>在 main.js 中有这么一段</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;App/&gt;&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123; App &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里的 el 就是这个 vue 实例要挂载的元素<br>template 是用来挂在的模版<br>components 是用来挂在的内容，也就是我们的 App.vue</p>
<p>这样App.vue的内容就自动注入到index.html中了</p>
<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>前面我们讲了，Vue 的特点之一是数据双向绑定，也就是说展示的内容和模型的内容是绑定的，同步的，修改一个，另一个就会一起变化，Vue在实现这个功能的时候，为了将所有数据都收归 Vue 来管理，所以数据的声明必须由 Vue 来操作</p>
<p>我们移步hello.vue</p>
<p>在代码块中有个 data() 函数，这个函数里面就是声明我们的数据区，在这里面声明的内容，Vue会自动给他加上 getter和setter，这个过程对使用者来说事透明的，你不会注意到她，当一个数据读取或者变化的时候，就会调用setter和getter，从而触发 Vue 对绑定这个数据的内容的刷新，所以我们的数据块，都在 data() 区声明，是很重要的</p>
<p>另外，data() 返回的不是一个数据实例，而是一个返回数据副本的函数，这个很重要</p>
<p>为什么呢，因为我们知道 Vue 的组件是可以复用的，所以每次都要返回单独的数据实例呀，否则不是成了相当于 Java 中 static 数据的东西了吗</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;Welcome to Your Vue.js App&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们看到，我们声明的数据，在写模版的时候用双层引号来渲染</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>我们的App.vue是怎么显示出hello.vue组件的内容的呢</p>
<p>我们看到 app 的模版中 有个 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个标签会自动渲染路由的内容</p>
<p>在 main.js 中我们引入了路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在router的index.js中我们看到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&#x27;@/components/Hello&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="comment">//配置访问路径</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Hello&#x27;</span>, <span class="comment">//配置路径“页面”名称</span></span><br><span class="line">      <span class="attr">component</span>: Hello <span class="comment">//配置要渲染的组件</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用了vue-router工具来做路由</p>
<p>导出了一个路由配置</p>
<p>所以我们在访问路径/的时候，Hello.vue就渲染在了 router-view 上</p>
<hr>
<h2 id="安装vue-admin"><a href="#安装vue-admin" class="headerlink" title="安装vue-admin"></a>安装vue-admin</h2><p><a target="_blank" rel="noopener" href="http://element.eleme.io/#/zh-CN/component/quickstart">ElementUI文档</a></p>
<p>ElementUI是饿了吗弄的一个模版，适合来做管理工具的前端</p>
<p>我们这里就直接使用一个基于elementui的开源模版vue-admin来开发</p>
<p>开发的时候又问题随时参考文档</p>
<p><a target="_blank" rel="noopener" href="https://github.com/taylorchen709/vue-admin">vue-admin</a></p>
<p>下载下来</p>
<p>删掉 frontend 目录里面的所有内容，然后把下载下来的 vue-admin 内容解压 copy 进去</p>
<p>然后在 frontend 中执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>因为里面有安装node-sass</p>
<p>如果安装出错了，可以先安装这个东西(支持一种css加强语法的工具)，加上镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SASS_BINARY_SITE=https://npm.taobao.org/mirrors/node-sass/ npm install node-sass</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm build</span><br></pre></td></tr></table></figure>

<p>我们还需要修改webpack中的一个参数让导出的静态调用地址适配 django中 的设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br></pre></td></tr></table></figure>

<p>打开 vue 项目中的webpack.config.js文件</p>
<p>修改为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assetsRoot: path.resolve(__dirname, <span class="string">&#x27;../dist/static&#x27;</span>),</span><br><span class="line"><span class="attr">assetsSubDirectory</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="attr">assetsPublicPath</span>: <span class="string">&#x27;/static/&#x27;</span>,</span><br></pre></td></tr></table></figure>

<p>这样webpack导出的内容中的static的东西，都会以/static/的url前缀去调用，和django中一样了</p>
<p>访问 django 的站点 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/">http://127.0.0.1:8000/qk_deploy/</a></p>
<p>和 vue 的测试站点 <a target="_blank" rel="noopener" href="http://127.0.0.1:8010/">http://127.0.0.1:8010/</a></p>
<p>现在都可以正确访问我们的内容了</p>
<p>但是为了不每次访问的时候都打包，所以一般我们用 vue 的测试站点来进行测试</p>
<hr>
<h2 id="对接API：登陆"><a href="#对接API：登陆" class="headerlink" title="对接API：登陆"></a>对接API：登陆</h2><p>我们可以看到 vue-admin 里面使用的是 axios 作为 Ajax 库</p>
<p>作为示范，作者使用 mock 来制作了假数据</p>
<p>我们屏蔽掉 mock 开始接入我们写好的 django 登陆 api</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改 main.js 屏蔽mock</span></span><br><span class="line"><span class="comment">// import Mock from &#x27;./mock&#x27;</span></span><br><span class="line"><span class="comment">// Mock.bootstrap();</span></span><br></pre></td></tr></table></figure>

<p>修改 api.js,设置为我们的接口地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let base = &#x27;&#x27;;</span></span><br><span class="line"><span class="keyword">let</span> base = <span class="string">&#x27;http://127.0.0.1:8000/qk_deploy/api&#x27;</span></span><br></pre></td></tr></table></figure>

<p>访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/#/login">http://127.0.0.1:8080/#/login</a></p>
<p>测试登陆</p>
<p>我们已经可以请求登陆啦~~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/" class="post-title-link" itemprop="url">Django项目开发（三）结合Vue</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-10 17:20:49" itemprop="dateCreated datePublished" datetime="2017-05-10T17:20:49+08:00">2017-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%89%EF%BC%89%E7%BB%93%E5%90%88Vue/">Mapz的blog</a></p>
<p>前文目录：</p>
<ol>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Django项目的搭建</a></li>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">Django项目开发（一）</a></li>
<li><a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/">Django项目开发（二）View层</a></li>
</ol>
<p>前面我们介绍了Django的一些基本安装和使用</p>
<p>因为我们项目将会使用前后端分离的技术来处理，所以我们将会放弃使用Django的View层来处理业务逻辑，而只是用Django做ORM和API接口，并使用 Vue.js 2 来制作前端页面</p>
<hr>
<h2 id="Vue-js-简介"><a href="#Vue-js-简介" class="headerlink" title="Vue.js 简介"></a>Vue.js 简介</h2><h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p>Vue 采用 MVVM 的模式，MVVM 是 MVC 的衍生物</p>
<p>他和 MVC 的区别在哪儿呢</p>
<p>在 MVVM 中 C 变成了 VM</p>
<p>在 MVC 中用户可以直接操作 C 层 或是通过 V 层来操作 Model</p>
<p>C 层一般只有路由的作用 而 V 层则承载了大量的业务逻辑，非常臃肿</p>
<p>而在 MVVM 中 View 和 Model 之间不再直接发生关系了</p>
<p>View 层也不在有任何业务逻辑，他是真的只作为展示层来使用</p>
<p>逻辑去了哪儿呢？答案是 VM 层，就是 ModelView</p>
<p>然后为什么说 MVVM 可以方便的实现数据和逻辑分离呢</p>
<p>关键在 VM 层和 M 层是双向绑定的</p>
<p>也就是说，我在 VM 层经过逻辑处理的数据，会自动表现在 View 层上，也会自动改变 Model 层中的数据</p>
<p>于是我们的数据、逻辑和渲染，就完全分开了</p>
<p>简而言之：</p>
<p><strong>我只需要修改好我的业务逻辑，配置好数据，写好模版，所有的一切就可以自动呈现和更新了</strong> </p>
<p>业务逻辑，数据和展示真正做到了分离</p>
<h3 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h3><p>Vue React Angular 都是最近比较流行的前端框架</p>
<p>数据的双向绑定，响应式和组件化 都是他们的思维要点</p>
<p>Vue 相比另两个，优点是学习成本低，性能高，并且虽然比不上另外两个，但任然有着比较丰富的生态</p>
<p>另外 Vue 还有他的原生兄弟 Weex</p>
<p>Weex 是阿里的跨平台用户界面开发框架，他兼容 Vue 的语法</p>
<p>也就是说 </p>
<p><strong>学会 Vue 之后，你也可以让你的代码跑上 iOS 和 Android</strong></p>
<p>当然啦，React 也有对应的 ReactNative 来做原生应用</p>
<hr>
<h2 id="集成-Vue-到-Django-中"><a href="#集成-Vue-到-Django-中" class="headerlink" title="集成 Vue 到 Django 中"></a>集成 Vue 到 Django 中</h2><p>我们假定你的机器上已经装好了</p>
<ul>
<li>Node.js 4+</li>
<li>npm 3+</li>
<li>Python 2.7+</li>
</ul>
<p>以下安装需要基于上述环境</p>
<h3 id="安装-vue-cli"><a href="#安装-vue-cli" class="headerlink" title="安装 vue-cli"></a>安装 vue-cli</h3><p>vue 一般使用 vue-cli 来初始化我们的项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-cli -g --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>-g 的意思是全局安装</p>
<p>–registry 参数是镜像，我们在国内一般用淘宝的镜像比较快</p>
<h3 id="创建-vue-项目"><a href="#创建-vue-项目" class="headerlink" title="创建 vue 项目"></a>创建 vue 项目</h3><p>回到我们的django项目的目录下，用vue-cli 创建一个项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-init webpack frontend</span><br></pre></td></tr></table></figure>

<p>其中 frontend 是我们的 vue 工程目录名称</p>
<p>中间的参数是我们要用到的模版</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>这个命令可以导出webpack输出，简单说就是web工程打包</p>
<p>build 好的内容导出 dist 目录下，也就是我们django中要用到的内容了</p>
<h3 id="Django下的配置"><a href="#Django下的配置" class="headerlink" title="Django下的配置"></a>Django下的配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># settings.py 需要加载模版，所以要修改我们的模版目录加上dist目录</span></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [<span class="string">&#x27;frontend/dist/&#x27;</span>],</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让Django能去dist下寻找静态文件</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&quot;frontend/dist/static&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># qk_deploy/urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将我们的文件直接作为模版引入</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^$&#x27;</span>, TemplateView.as_view(template_name=<span class="string">&quot;index.html&quot;</span>))</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们现在访问</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/#/">http://127.0.0.1:8000/qk_deploy/#/</a></p>
<p>应该可以看到 vue 的欢迎页面了</p>
<h3 id="搭建调试环境"><a href="#搭建调试环境" class="headerlink" title="搭建调试环境"></a>搭建调试环境</h3><p>如果我们使用 Django的环境来进行测试呢，也就会导致，每次修改了vue项目的文件都要重新build，这样太慢了</p>
<p>vue.js的开发环境会自动检查文件变化来重新构建，是比较方便的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>会启动vue的开发环境，但这样有个问题，使用vue的开发环境，就是脱离了Django的开发环境了，访问Django上的API出现了跨域问题</p>
<p>为了能让我们快乐的调试呢，我们使用Django的第三方插件django-cors-headers来解决跨域问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">MIDDLEWARE_CLASSES = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>, <span class="comment">#注意顺序不能变</span></span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span> <span class="comment">#添加这个配置</span></span><br></pre></td></tr></table></figure>

<h3 id="Django-配置-RESTful-API"><a href="#Django-配置-RESTful-API" class="headerlink" title="Django 配置 RESTful API"></a>Django 配置 RESTful API</h3><p>不用Django的后端渲染了，我们使用RESTful API作为前后端交流的工具</p>
<h4 id="安装-djangorestframework"><a href="#安装-djangorestframework" class="headerlink" title="安装 djangorestframework "></a>安装 djangorestframework </h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br><span class="line">pip install markdown -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br><span class="line">pip install django-filter -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</span><br></pre></td></tr></table></figure>

<p>这里我们和 npm 安装东西的时候一样，使用了镜像，不然下载的太慢了啦 pip 使用镜像用-i参数<br>对于不是https的地址，必须用 –trusted-host 才能继续</p>
<p>装好后</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">INSTALLED_APPS = (</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目根目录下 url.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r&#x27;^api-auth/&#x27;</span>, include(<span class="string">&#x27;rest_framework.urls&#x27;</span>, namespace=<span class="string">&#x27;rest_framework&#x27;</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="创建model和serializer"><a href="#创建model和serializer" class="headerlink" title="创建model和serializer"></a>创建model和serializer</h4><p>我们这里将用用户登陆为例，来看怎么写和使用API</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions,status</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BasicAuthentication</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserLogin</span>(<span class="params">generics.CreateAPIView</span>):</span></span><br><span class="line">    permission_classes = (permissions.AllowAny,)</span><br><span class="line">    serializer_class = LoginSerializer</span><br><span class="line">    authentication_classes = (BasicAuthentication,) <span class="comment">#这里一定要是 BasicAuthentication，否则会出现CSRF问题，因为我们现在是登陆，登录前么有在session中用CSRF，这个问题我们后面来说</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            username = request.data.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(username)</span><br><span class="line">            password = request.data.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(password)</span><br><span class="line">            user = User.objects.get(username__iexact=username)</span><br><span class="line">            <span class="built_in">print</span>(user)</span><br><span class="line">            <span class="keyword">if</span> user.check_password(password):</span><br><span class="line">                serializer = LoginSerializer(&#123;<span class="string">&#x27;id&#x27;</span>: user.<span class="built_in">id</span>, <span class="string">&#x27;username&#x27;</span>: user.username&#125;)</span><br><span class="line">                <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_401_UNAUTHORIZED)</span><br><span class="line">        <span class="keyword">except</span> User.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> Response(status=status.HTTP_401_UNAUTHORIZED)</span><br></pre></td></tr></table></figure>

<p>创建我们的登陆view<br><br>创建serializers.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginSerializer</span>(<span class="params">serializers.ModelSerializer</span>):</span></span><br><span class="line"></span><br><span class="line">    username = serializers.CharField(required=<span class="literal">False</span>, max_length=<span class="number">1024</span>)</span><br><span class="line">    password = serializers.CharField(required=<span class="literal">False</span>, max_length=<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = User</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>urls.py中加上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r&#x27;^api/login$&#x27;</span>, UserLogin.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>访问</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/api/login">http://127.0.0.1:8000/qk_deploy/api/login</a></p>
<p>可以看到 restful_framework的测试界面</p>
<p>在界面测试API</p>
<p>用已有的用户登陆，已经可以看到正确的回应了，否则会返回状态401</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/" class="post-title-link" itemprop="url">Django项目开发（二）View层</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-10 10:55:48" itemprop="dateCreated datePublished" datetime="2017-05-10T10:55:48+08:00">2017-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a href="https://mapz.github.io/2017/05/10/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89View%E5%B1%82/">Mapz的blog</a></p>
<p>前文目录：</p>
<ol>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Django项目的搭建</a></li>
<li><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">Django项目开发（一）</a></li>
</ol>
<p>前面我们已经创建好了我们的数据库表，也可以管理我们的数据内容了，下面就应该是如何来展示我们的网站内容</p>
<h2 id="基本方式"><a href="#基本方式" class="headerlink" title="基本方式"></a>基本方式</h2><p>前面大家看例子的时候已经看到了，我们在 views.py 中，写一个函数，返回一个HttpRespnse对象，参数为字符串hello world，并在 urls.py 里面配置好他的路由，就可以通过浏览器来访问我们的页面了，没错，这就是一个最简单的view，返回一个HttpRespnse对象，只包含一段字符串到浏览器。</p>
<hr>
<h2 id="Url路由"><a href="#Url路由" class="headerlink" title="Url路由"></a>Url路由</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^$&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>每增加一个路由，我们都在urlpatterns里面增加一个url()函数生成的对象</p>
<p>我们可以看看这个函数原型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url</span>(<span class="params">regex, view, kwargs=<span class="literal">None</span>, name=<span class="literal">None</span>, prefix=<span class="string">&#x27;&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>

<ol>
<li>第一个参数为浏览器访问的url路由正则表达式</li>
<li>第二个参数是处理这个请求的view</li>
<li>第三个参数是显式的传入参数</li>
<li>第四个参数是这个url的名称，常用于渲染模版的时候，避免改需求后模版上url写死了要到处修改用（写模版的时候不要写死跳转的url，而是用name来渲染是一个良好的习惯），另外，后面我们会知道，一个视图view经常对应很多pattern，用name也可在使用的时候加以区分</li>
<li>prefix 在view上加上前缀，一般不会用到这个</li>
</ol>
<p>正则表达式中用小括号括起来的内容，会作为参数传入到view中的处理函数中</p>
<p>为了测试路由中各种用法，我们创建一个文件专门放我们的测试view</p>
<h3 id="隐式的传参"><a href="#隐式的传参" class="headerlink" title="隐式的传参"></a>隐式的传参</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_views.py</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">request,p1,p2</span>):</span></span><br><span class="line">    p1 = <span class="built_in">float</span>(p1)</span><br><span class="line">    p2 = <span class="built_in">float</span>(p2)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;%f + %f = %f&quot;</span> % (p1,p2,p1+p2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views,test_views</span><br><span class="line">testPatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^add(\d+)and(\d+)/$&#x27;</span>, test_views.add, name=<span class="string">&#x27;add&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns.extend(testPatterns)</span><br></pre></td></tr></table></figure>

<p>我们看url中有两个参数</p>
<p>当我们访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/add1and2/">http://127.0.0.1:8000/qk_deploy/add1and2/</a> 的时候，他们被顺序的传入test_view.add函数的p1和p2</p>
<p>需要注意的是，通过正则穿进去的参数，都是字符串形式的，要转型需要我们在代码中处理</p>
<p>最后我们在浏览器中得到了返回</p>
<blockquote>
<p>1.000000 + 2.000000 = 3.000000</p>
</blockquote>
<h3 id="显式的传参"><a href="#显式的传参" class="headerlink" title="显式的传参"></a>显式的传参</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">southparkB</span>(<span class="params">request,stan_power,cartman_power</span>):</span></span><br><span class="line">    stan_power = <span class="built_in">float</span>(stan_power)</span><br><span class="line">    cartman_power = <span class="built_in">float</span>(cartman_power)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;Stan win&#x27;</span> <span class="keyword">if</span> stan_power &gt; cartman_power <span class="keyword">else</span> <span class="string">&#x27;Cartman win&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line">testPatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r&#x27;^southpark-b/stan(?P&lt;stan_power&gt;\d+)/cartman(?P&lt;cartman_power&gt;\d+)/$&#x27;</span>, test_views.southparkB,name=<span class="string">&#x27;southparkB&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns.extend(testPatterns)</span><br></pre></td></tr></table></figure>

<p>用括号括起来的部分依然是参数，但是我们用__?P&lt;参数名&gt;__来传递参数<br>然后在 test_view.southparkB 中，用相同的参数名来取出</p>
<p>访问</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/southpark-b/stan19/cartman10/">http://127.0.0.1:8000/qk_deploy/southpark-b/stan19/cartman10/</a></p>
<p>获得结果</p>
<blockquote>
<p>Stan win</p>
</blockquote>
<hr>
<h2 id="结合数据层使用"><a href="#结合数据层使用" class="headerlink" title="结合数据层使用"></a>结合数据层使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project_list</span>(<span class="params">request</span>):</span></span><br><span class="line">    p_list = Project.objects.order_by(<span class="string">&#x27;project_name&#x27;</span>)</span><br><span class="line">    output = <span class="string">&#x27;, &#x27;</span>.join([q.project_name <span class="keyword">for</span> q <span class="keyword">in</span> p_list])</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(output)</span><br><span class="line"></span><br><span class="line"><span class="comment">#urls.py</span></span><br><span class="line">testPatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(<span class="string">r&#x27;^projectlist/$&#x27;</span>,test_views.project_list,name=<span class="string">&#x27;project_list&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/projectlist/">http://127.0.0.1:8000/qk_deploy/projectlist/</a></p>
<p>可以看到打印出了我们已经创建的项目列表</p>
<hr>
<h2 id="加入模版系统"><a href="#加入模版系统" class="headerlink" title="加入模版系统"></a>加入模版系统</h2><p>我们现在已经可以输出我们需要的内容到页面了，但是还不够美观，我们想要输出的是一个页面，而不是简单的字符串。</p>
<p>这时候我们就要用到 Django 的服务端渲染-模版技术</p>
<h3 id="题外话：如果你想使用前后端分离"><a href="#题外话：如果你想使用前后端分离" class="headerlink" title="题外话：如果你想使用前后端分离"></a><strong>题外话：如果你想使用前后端分离</strong></h3><p>现在前后端分离的开发方式比较热门，笔者也研究过 vue.js 前端框架</p>
<p>要实现前后端分离，我们的后端渲染就算是用不上啦，至于业务逻辑，也需要放到前端来处理，view也不用处理业务逻辑了</p>
<p>我们只需要把API接口做好就可以了</p>
<p>我们只需要保留Django的controller部分，也就是urlconf这一块</p>
<p>这样一来做到了前后端分离</p>
<p>二来呢，django可以是很灵活的，同一个网站你可以部分页面采用 vue 部分采用 react，部分用django模版来渲染也行呀~</p>
<p>我们的项目将会基于vue.js 2来进行开发，搭建将在后面的文章中详细解说</p>
<p>在这之前，我们还是先简单讲讲 Django 自身的模版系统</p>
<h3 id="创建模版"><a href="#创建模版" class="headerlink" title="创建模版"></a><strong>创建模版</strong></h3><p>我们在app目录下创建templates目录</p>
<p>模版的具体设置在settings中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>当 APP_DIRS 为 True 的时候，Django会所有已经安装了的APP目录下的templates中寻找模版</p>
<p>我们继续在templates目录下创建目录qk_deploy目录，并在里面创建project_list.html </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if p_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% for p in p_list %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; p.project_name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>还没有创建项目<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>修改我们的view</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test_views.py</span></span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project_list</span>(<span class="params">request</span>):</span></span><br><span class="line">    p_list = Project.objects.order_by(<span class="string">&#x27;project_name&#x27;</span>)</span><br><span class="line">    template = loader.get_template(<span class="string">&#x27;qk_deploy/project_list.html&#x27;</span>)</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">&#x27;p_list&#x27;</span>:p_list,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context,request))</span><br></pre></td></tr></table></figure>

<p>重新访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/projectlist/">http://127.0.0.1:8000/qk_deploy/projectlist/</a></p>
<p>我们会发现我们的列表已经按模版的形式重新渲染了</p>
<ul>
<li>项目1</li>
<li>项目2</li>
<li>等等</li>
</ul>
<p>render还可以简写为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project_list</span>(<span class="params">request</span>):</span></span><br><span class="line">    p_list = Project.objects.order_by(<span class="string">&#x27;project_name&#x27;</span>)</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">&#x27;p_list&#x27;</span>:p_list,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(render(request,<span class="string">&#x27;qk_deploy/project_list.html&#x27;</span>,context))</span><br></pre></td></tr></table></figure>

<h3 id="其他模版相关内容"><a href="#其他模版相关内容" class="headerlink" title="其他模版相关内容"></a>其他模版相关内容</h3><p>我们这里就不赘述其他的 django 模版相关的内容了</p>
<p>有兴趣可以参考 <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.11/intro/tutorial03/">官方教程</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">Django项目开发（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-08 17:19:10" itemprop="dateCreated datePublished" datetime="2017-05-08T17:19:10+08:00">2017-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址：<a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89/">Mapz的blog</a></p>
<p><strong>这是系列第二篇，第一篇请移步</strong></p>
<p><a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Django项目的搭建</a></p>
<p>上一次我们介绍了如何搭建django项目，本次我们继续学习django项目的开发</p>
<hr>
<h2 id="数据库的接入"><a href="#数据库的接入" class="headerlink" title="数据库的接入"></a>数据库的接入</h2><p>我们这里使用mySql数据库</p>
<p>先在虚拟环境中装 pymysql <strong>（MySQLdb在Python3中已经不能用）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure>

<p>打开settings.py</p>
<p>修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment"># &#x27;ENGINE&#x27;: &#x27;django.db.backends.sqlite3&#x27;,</span></span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>, <span class="comment">#数据库引擎</span></span><br><span class="line">        <span class="comment"># &#x27;NAME&#x27;: os.path.join(BASE_DIR, &#x27;db.sqlite3&#x27;),</span></span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;proj_mgr_kits&#x27;</span>, <span class="comment">#你的数据库名称</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;***&#x27;</span>, <span class="comment">#数据库用户</span></span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;***&#x27;</span>, <span class="comment">#数据库密码</span></span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;***&#x27;</span>, <span class="comment">#数据库主机</span></span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="string">&#x27;3306&#x27;</span>, <span class="comment">#数据库端口</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>详细修改方式参见 <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.11/ref/settings/">官网文档</a></p>
<p>另外针对 pymysql 还需要配置站点的_<em>init</em>_.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="其他配置"><a href="#其他配置" class="headerlink" title="其他配置"></a>其他配置</h2><p>设置时区和语言</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">&#x27;zh-Hans&#x27;</span></span><br><span class="line"></span><br><span class="line">TIME_ZONE = <span class="string">&#x27;PRC&#x27;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Django结构简介"><a href="#Django结构简介" class="headerlink" title="Django结构简介"></a>Django结构简介</h2><p>django是一个MVC框架，数据上，使用模型model做ORM映射数据库</p>
<p>view层使用django的模版来做渲染</p>
<p>控制层用灵活的url路由来实现，后面我们陆续来介绍这些内容</p>
<hr>
<h2 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>这个命令会创建所有已安装的APP所需的数据表</p>
<p>所有已经安装的APP被配置在 <strong>settings.py</strong> 的<br><strong>INSTALLED_APPS</strong> 属性下</p>
<hr>
<h2 id="创建model"><a href="#创建model" class="headerlink" title="创建model"></a>创建model</h2><p>Model 是 Django做对象映射的模型，你创建的 Model 类会被diango映射到数据库中</p>
<p>我们创建一个自己的model</p>
<p>修改 models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    project_name = models.CharField(max_length=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>

<p>Model 支持的数据类型和创建参数参见 <a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.11/ref/models/fields/#django.db.models.Field">官方文档</a></p>
<p>常用的参数比如choices,可以让参数在一个枚举中选择</p>
<p>例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeployProfile</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    deploy_type_choice = (</span><br><span class="line">        (<span class="string">&#x27;Server&#x27;</span>,<span class="string">&#x27;服务器&#x27;</span>), <span class="comment">#第一个参数为数据库保存值，第二个为显示在界面的值</span></span><br><span class="line">        (<span class="string">&#x27;CLient&#x27;</span>,<span class="string">&#x27;客户端&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    deploy_type = models.CharField(max_length=<span class="number">20</span>, choices=deploy_type_choice, verbose_name=<span class="string">&#x27;部署类型&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>其他的类型就不再赘述</p>
<hr>
<h2 id="把我们自己的app加入到项目app中"><a href="#把我们自己的app加入到项目app中" class="headerlink" title="把我们自己的app加入到项目app中"></a>把我们自己的app加入到项目app中</h2><p>编辑settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;xxxxx&#x27;</span></span><br><span class="line">    <span class="string">&#x27;qk_deploy.apps.QkDeployConfig&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;xxxxx&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>重新创建表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations qk_deploy</span><br></pre></td></tr></table></figure>

<p><strong>makemigrations</strong> 命令告诉系统，我的模型已经发生了变化，需要制作一个迁移</p>
<p>迁移做好之后，我们再用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>重新制作数据表</p>
<hr>
<h2 id="创建管理员"><a href="#创建管理员" class="headerlink" title="创建管理员"></a>创建管理员</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>

<p>然后按提示输入，来创建一个管理员</p>
<p>启动服务器后</p>
<p>进入页面</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a></p>
<p>就可以用你的管理员来登陆管理界面了</p>
<hr>
<h2 id="把我们的app加入到管理界面中来"><a href="#把我们的app加入到管理界面中来" class="headerlink" title="把我们的app加入到管理界面中来"></a>把我们的app加入到管理界面中来</h2><p>修改app目录下的admin.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Project</span><br><span class="line">admin.site.register(Project)</span><br></pre></td></tr></table></figure>

<p>就可以了</p>
<p>register参数也接收一个可迭代容器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.site.register([Project,p1,p2,p3])</span><br></pre></td></tr></table></figure>

<p>然后我们进入管理页面，发现上面的model已经可以管理了</p>
<p>但是如果我们想有一个自定义的名称，而不是类的名字，怎么办呢？</p>
<p>答案是在model中加上 meta </p>
<p>编辑Project model</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    project_name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;项目&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<p>其中 verbose_name 是显示的名称，而 plural是复数形式，我们中文没有复数形式，所以就直接一样就ok了</p>
<p>双薪管理页面，我们发现管理中显示的内容已经是我们写的’项目’了</p>
<p>至于模型的字段要显示我们想要的名字呢，也是一样的，修改model</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    project_name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;项目&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<p>好奇的同学又要问了，APP名字在管理界面怎么改呀</p>
<p>我们修改apps.py</p>
<p>在QkDeployConfig类下面增加一个属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QkDeployConfig</span>(<span class="params">AppConfig</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;qk_deploy&#x27;</span></span><br><span class="line">    verbose_name = <span class="string">&#x27;部署管理器&#x27;</span></span><br></pre></td></tr></table></figure>

<p>刷新管理界面再看看~~</p>
<p>我们用管理工具创建新项目后，新项目在列表里面显示为 project object,这显然不是我们想要的，怎么办咧</p>
<p>为model加上字符串返回函数就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Project</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    project_name = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">&#x27;项目名称&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.project_name</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;项目&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure>

<p>刷新管理界面，显示的项目已经是我们设定的项目名称了</p>
<hr>
<h2 id="文本编码问题"><a href="#文本编码问题" class="headerlink" title="文本编码问题"></a>文本编码问题</h2><p>如果遇到中文无法录入管理系统的问题，请检查数据库编码是否和程序中一致哦</p>
<p>不一致的话，请先修改数据库编码，然后删除数据表，重新migrate</p>
<hr>
<p>到此，我们的数据库管理功能已经完成，也就是MVC中的M</p>
<p>下次我们继续说MVC中的V ，也就是 view 展示层</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">Django项目的搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-08 14:50:20" itemprop="dateCreated datePublished" datetime="2017-05-08T14:50:20+08:00">2017-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址 <a href="https://mapz.github.io/2017/05/08/Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%90%AD%E5%BB%BA/">Mapz的Blog</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Django作为成熟的 Python Web框架，有很多第三方模块，比如<a target="_blank" rel="noopener" href="https://djangopackages.org/">djangoPackages</a>就是一个发布django模块的站点。</p>
<p>Django作为快速开发，还是比较适合的。</p>
<h2 id="安装Django"><a href="#安装Django" class="headerlink" title="安装Django"></a>安装Django</h2><p><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/1.11/intro/install/">官网文档</a></p>
<p>我们用Python3.5来安装Django</p>
<p>老路子，Python工程，先创建虚拟环境，避免包环境污染</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv django_env</span><br></pre></td></tr></table></figure>

<h3 id="Django本体安装"><a href="#Django本体安装" class="headerlink" title="Django本体安装"></a>Django本体安装</h3><p>我这里默认环境是3.5python，如果你不是默认3.5的话，需要指定 virtualenv 参数，这里就不赘述了</p>
<p>进入虚拟环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ./django_env/bin/activate</span><br></pre></td></tr></table></figure>

<p>使用pip安装django，我们就安装最新的版本吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Django==1.11.1</span><br></pre></td></tr></table></figure>

<p>安装后校验是否成功</p>
<p>进入python控制台</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python</span><br></pre></td></tr></table></figure>

<p>校验安装版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> django</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>django.get_version()</span><br><span class="line"><span class="string">&#x27;1.11.1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>或者简单的在shell中检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m django --version</span><br></pre></td></tr></table></figure>

<h3 id="数据库安装"><a href="#数据库安装" class="headerlink" title="数据库安装"></a>数据库安装</h3><p>我们这里就用mysql来作数据库，安装过程略去</p>
<hr>
<h2 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>在合适的目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject proj_mgr_kits</span><br></pre></td></tr></table></figure>

<p>django会创建一个目录树</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">proj_mgr_kits/   #可以随意改名，这个目录名不影响django的逻辑</span><br><span class="line">    manage.py    #django的管理命令行工具</span><br><span class="line">    proj_mgr_kits/  #这是一个python包目录了</span><br><span class="line">        __init__.py</span><br><span class="line">        settings.py #配置文件</span><br><span class="line">        urls.py</span><br><span class="line">        wsgi.py</span><br><span class="line">```        </span><br><span class="line"></span><br><span class="line">### 启动测试服</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>浏览器打开 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a></p>
<p>出现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">It worked!</span><br><span class="line">Congratulations on your first Django-powered page.</span><br><span class="line">Next, start your first app by running python manage.py startapp [app_label].</span><br><span class="line">You&#x27;re seeing this message because you have DEBUG = True in your Django settings file and you haven&#x27;t configured any URLs. Get to work!</span><br></pre></td></tr></table></figure>

<p>启动成功</p>
<p>runserver 后面接上IP端口号，可以指定启动的IP和端口</p>
<p><strong>测试服启动期间，修改了python代码后，会自动加载</strong> </p>
<p>如果有不能加载的，请手动restart</p>
<h3 id="Django的App和Project概念"><a href="#Django的App和Project概念" class="headerlink" title="Django的App和Project概念"></a>Django的App和Project概念</h3><p>Django中 的一个Project，简单说就是一个网站</p>
<p>一个网站中可以有很多的App , 也就是功能模块</p>
<p>一个App可以在多个项目中使用</p>
<h3 id="创建我们的APP"><a href="#创建我们的APP" class="headerlink" title="创建我们的APP"></a>创建我们的APP</h3><p>我们创建一个名为 qk_deploy 的APP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp qk_deploy</span><br></pre></td></tr></table></figure>

<p>将会在目录中创建 qk_deploy 目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qk_deploy</span><br><span class="line">├── __init__.py </span><br><span class="line">├── admin.py</span><br><span class="line">├── apps.py</span><br><span class="line">├── migrations</span><br><span class="line">│   └── __init__.py</span><br><span class="line">├── models.py</span><br><span class="line">├── tests.py</span><br><span class="line">└── views.py  </span><br></pre></td></tr></table></figure>

<h3 id="创建我们的第一个页面"><a href="#创建我们的第一个页面" class="headerlink" title="创建我们的第一个页面"></a>创建我们的第一个页面</h3><p>这里包含我们写Django的几个基本步骤</p>
<ol>
<li>创建页面</li>
<li>配置路由</li>
</ol>
<h4 id="创建页面"><a href="#创建页面" class="headerlink" title="创建页面"></a>创建页面</h4><p>修改 view.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Hello, world.&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><p>修改 app下的 urls.py（没有就自己创建一个）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^$&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>修改 工程下的 urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> include, url</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^qk_deploy/&#x27;</span>, include(<span class="string">&#x27;qk_deploy.urls&#x27;</span>)),</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="访问页面"><a href="#访问页面" class="headerlink" title="访问页面"></a>访问页面</h3><p>浏览器打开 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/qk_deploy/">http://127.0.0.1:8000/qk_deploy/</a></p>
<p>出现</p>
<blockquote>
<p>Hello, world.</p>
</blockquote>
<p>一个页面就创建成果了，是否很简单哇</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/04/%E4%BD%BF%E7%94%A8supervisor%E6%9D%A5%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/04/%E4%BD%BF%E7%94%A8supervisor%E6%9D%A5%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">使用supervisor来监控系统进程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-04 16:59:40" itemprop="dateCreated datePublished" datetime="2017-05-04T16:59:40+08:00">2017-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原文地址 <a href="https://mapz.github.io/2017/05/04/%E4%BD%BF%E7%94%A8supervisor%E6%9D%A5%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B/">Mapz的Blog</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>跑着的进程被系统杀啦？OOM？CPU爆了？一个稳定的系统环境需要一个进程监控工具，supervisor是一款基于Pyhton的进程监控工具，这次我们来学习使用之。</p>
<p>官方文档<a target="_blank" rel="noopener" href="http://supervisord.org/index.html">点我</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>用pip安装的话，python3上现在还没有可用的安装包（貌似）</p>
<p>所以我们用虚拟环境搭载python2.7安装supervisor</p>
<p>假设我们已经安装好了Python的虚拟环境工具 virturlenv</p>
<p>在你合适的目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virtualenv --python=python2.7 ./supervisor_env</span><br><span class="line"><span class="built_in">source</span> supervisor_env/bin/activat</span><br><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure>

<p>安装完成！</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf</span><br></pre></td></tr></table></figure>

<p>这个可以显示supervisor的默认配置项目</p>
<p>我们把这些配置导入一个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf &gt; ./supervisord.conf</span><br></pre></td></tr></table></figure>

<p>然后使用 supervisord -c 配置文件路径 就可以启动了<br>如果不用-c参数则会按下列顺序来查找配置</p>
<blockquote>
<p>$CWD/supervisord.conf, $CWD/etc/supervisord.conf, /etc/supervisord.conf</p>
</blockquote>
<p>所以我们的启动命令为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisord -c ./supervisord.conf</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h2 id="配置include文件内容"><a href="#配置include文件内容" class="headerlink" title="配置include文件内容"></a>配置include文件内容</h2><p>我们可以把所有的配置项目都写入到 supervisord.conf 里面，但是这样显然不方便管理，我们最好把监控不同程序的配置分别写成配置文件，然后在supervisord.conf中来引用他们</p>
<p>新建一个目录来存储我们的各目录配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir process_config</span><br></pre></td></tr></table></figure>

<p>编辑supervisord.conf，最下方include注释解开，改为</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[include]</span></span><br><span class="line"><span class="attr">files</span> = process_config/*.conf</span><br></pre></td></tr></table></figure>

<h3 id="配置程序监控"><a href="#配置程序监控" class="headerlink" title="配置程序监控"></a>配置程序监控</h3><p>以我机器上经常因为OOM而挂掉的elasticsearch为例，我们来写一份配置</p>
<p>我们的安装路径位于</p>
<blockquote>
<p>~/Downloads/elasticsearch-5.2.2/bin</p>
</blockquote>
<p>所以这个进程启动命令应该是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Downloads/elasticsearch-5.2.2/bin/elasticsearch</span><br></pre></td></tr></table></figure>

<p>我们在 process_config 目录下创建新配置文件 elasticsearch.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> process_config</span><br><span class="line">touch elasticsearch.conf</span><br></pre></td></tr></table></figure>

<p>编辑之</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:elasticsearch]</span></span><br><span class="line"><span class="attr">directory</span> = ~/Downloads/elasticsearch-<span class="number">5.2</span>.<span class="number">2</span>/bin/ <span class="comment">; 程序的启动目录</span></span><br><span class="line"><span class="attr">command</span> = elasticsearch <span class="comment">; 启动命令，可以看出与手动在命令行启动的命令是一样的</span></span><br><span class="line"><span class="attr">autostart</span> = <span class="literal">true</span>     <span class="comment">; 在 supervisord 启动的时候也自动启动</span></span><br><span class="line"><span class="attr">startsecs</span> = <span class="number">5</span>        <span class="comment">; 启动 5 秒后没有异常退出，就当作已经正常启动了</span></span><br><span class="line"><span class="attr">autorestart</span> = <span class="literal">true</span>   <span class="comment">; 程序异常退出后自动重启</span></span><br><span class="line"><span class="attr">startretries</span> = <span class="number">3</span>     <span class="comment">; 启动失败自动重试次数，默认是 3</span></span><br><span class="line"><span class="attr">user</span> = MapzChen          <span class="comment">; 用哪个用户启动</span></span><br><span class="line"><span class="attr">redirect_stderr</span> = <span class="literal">true</span>  <span class="comment">; 把 stderr 重定向到 stdout，默认 false</span></span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span> = <span class="number">20</span>MB  <span class="comment">; stdout 日志文件大小，默认 50MB</span></span><br><span class="line"><span class="attr">stdout_logfile_backups</span> = <span class="number">20</span>     <span class="comment">; stdout 日志文件备份数</span></span><br><span class="line"><span class="comment">; stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）</span></span><br><span class="line"><span class="attr">stdout_logfile</span> = ./logs/usercenter_stdout.log <span class="comment">;目录要存在哦</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">; 可以通过 environment 来添加需要的环境变量，一种常见的用法是修改 PYTHONPATH</span></span><br><span class="line"><span class="comment">; environment=PYTHONPATH=$PYTHONPATH:/path/to/somewhere</span></span><br></pre></td></tr></table></figure>

<h2 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h2><p>supervisor 自带了Shell管理工具 supervisorctl</p>
<p>运行方式和运行supervisor一致</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c ./supervisord.conf</span><br></pre></td></tr></table></figure>

<p>运行后进入shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; status    <span class="comment"># 查看程序状态</span></span><br><span class="line">&gt; stop usercenter   <span class="comment"># 关闭 usercenter 程序</span></span><br><span class="line">&gt; start usercenter  <span class="comment"># 启动 usercenter 程序</span></span><br><span class="line">&gt; restart usercenter    <span class="comment"># 重启 usercenter 程序</span></span><br><span class="line">&gt; reread    ＃ 读取有更新（增加）的配置文件，不会启动新添加的程序</span><br><span class="line">&gt; update    ＃ 重启配置文件修改过的程序</span><br></pre></td></tr></table></figure>

<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>运行 supervisor 后老出错找不到elasticsearch，然后路径什么的配置的并没有问题呀</p>
<p>网上找了个办法，使用一个bash文件来打开elas，然后supervisor中配置这个bash文件</p>
<h3 id="创建程序的启动脚本"><a href="#创建程序的启动脚本" class="headerlink" title="创建程序的启动脚本"></a>创建程序的启动脚本</h3><p>创建一个脚本来启动elas，并加入权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir bashs</span><br><span class="line">touch bashs/elasticsearch.sh</span><br><span class="line">chmod bashs/elasticsearch.sh</span><br></pre></td></tr></table></figure>

<p>编辑 bashs/elasticsearch.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash  </span></span><br><span class="line">/Users/mapzchen/Downloads/elasticsearch-5.2.2/bin/elasticsearch</span><br></pre></td></tr></table></figure>

<p>重新配置 elasticsearch.conf</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:elasticsearch]</span></span><br><span class="line"><span class="attr">directory</span> = /Volumes/store/py_apps/supervisor/bashs <span class="comment">; 程序的启动目录</span></span><br><span class="line"><span class="attr">command</span> = /Volumes/store/py_apps/supervisor/bashs/elasticsearch.sh <span class="comment">; 启动命令，可以看出与手动在命令行启动的命令是一样的</span></span><br><span class="line"><span class="attr">autostart</span> = <span class="literal">true</span>     <span class="comment">; 在 supervisord 启动的时候也自动启动</span></span><br><span class="line"><span class="attr">startsecs</span> = <span class="number">5</span>        <span class="comment">; 启动 5 秒后没有异常退出，就当作已经正常启动了</span></span><br><span class="line"><span class="attr">autorestart</span> = <span class="literal">true</span>   <span class="comment">; 程序异常退出后自动重启</span></span><br><span class="line"><span class="attr">startretries</span> = <span class="number">3</span>     <span class="comment">; 启动失败自动重试次数，默认是 3</span></span><br><span class="line"><span class="attr">user</span> = mapzchen          <span class="comment">; 用哪个用户启动</span></span><br><span class="line"><span class="attr">redirect_stderr</span> = <span class="literal">true</span>  <span class="comment">; 把 stderr 重定向到 stdout，默认 false</span></span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span> = <span class="number">20</span>MB  <span class="comment">; stdout 日志文件大小，默认 50MB</span></span><br><span class="line"><span class="attr">stdout_logfile_backups</span> = <span class="number">20</span>     <span class="comment">; stdout 日志文件备份数</span></span><br><span class="line"><span class="comment">; stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）</span></span><br><span class="line"><span class="attr">stdout_logfile</span> = ./logs/usercenter_stdout.log <span class="comment">;目录要存在哦</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">; 可以通过 environment 来添加需要的环境变量，一种常见的用法是修改 PYTHONPATH</span></span><br><span class="line"><span class="comment">; environment=PYTHONPATH=$PYTHONPATH:/path/to/somewhere</span></span><br></pre></td></tr></table></figure>

<p>启动,检查状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch                    RUNNING   pid 35058, uptime 0:06:11</span><br></pre></td></tr></table></figure>

<p>已经启动成功啦~~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mapz.github.io/2017/05/01/%E5%9C%A8Mac%E4%B8%8A%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8Scrapy%E5%92%8CphantomJs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/link-300x300.gif">
      <meta itemprop="name" content="Mapz">
      <meta itemprop="description" content="FIND THE CHILD">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mapz's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/01/%E5%9C%A8Mac%E4%B8%8A%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8Scrapy%E5%92%8CphantomJs/" class="post-title-link" itemprop="url">在Mac上组合使用Scrapy和phantomJs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-01 22:45:01" itemprop="dateCreated datePublished" datetime="2017-05-01T22:45:01+08:00">2017-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-22 10:15:32" itemprop="dateModified" datetime="2021-04-22T10:15:32+08:00">2021-04-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我们做爬虫的的时候，经常会遇到页面中的部分是由js生成并渲染的情况，这时爬虫爬到的页面还并非呈现在用户面前的页面，要得到需要的内容，可以用大招…还是用浏览器核心来渲染一遍</p>
<p>我准备尝试用PhantomJs–基于Webkit的服务端JS API（说大白话点，就是个隐形的浏览器，并且这货还提供了文件处理的IO操作）用来帮我们处理爬虫爬到的页面的渲染工作。</p>
<hr>
<h2 id="安装PhantomJS"><a href="#安装PhantomJS" class="headerlink" title="安装PhantomJS"></a>安装PhantomJS</h2><p><a target="_blank" rel="noopener" href="https://npm.taobao.org/dist/phantomjs">下载地址</a><br>这个是已经编译好的</p>
<p>不要用npm装，不然会不能正常运行</p>
<p>下载后解压后把目录下的bin路径加入PATH中就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phantomjs --version</span><br></pre></td></tr></table></figure>

<p>如果不报错，则已经安装好了</p>
<hr>
<h2 id="番外：想要安装HomeBrew"><a href="#番外：想要安装HomeBrew" class="headerlink" title="番外：想要安装HomeBrew"></a>番外：想要安装HomeBrew</h2><p>那就这么安吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span> &lt; /dev/null 2&gt; /dev/null</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Scrapy安装"><a href="#Scrapy安装" class="headerlink" title="Scrapy安装"></a>Scrapy安装</h2><p><strong>略</strong> （假设你已经懂Scrapy怎么玩）</p>
<hr>
<h2 id="安装selenium"><a href="#安装selenium" class="headerlink" title="安装selenium"></a>安装selenium</h2><p>selenium支持在Python中使用多种浏览器来模拟行为，同样PhantomJS也不在话下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install selenium</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>Scrapy中间件增加一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> HtmlResponse</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JSProcessMiddleware</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span>(<span class="params">self, request, spider</span>):</span></span><br><span class="line">        driver = webdriver.PhantomJS(executable_path = <span class="string">&#x27;你的phantomjs安装路径&#x27;</span>)</span><br><span class="line">        driver.get(request.url)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        js = <span class="string">&quot;var q=document.documentElement.scrollTop=10000&quot;</span></span><br><span class="line">        driver.execute_script(js)  <span class="comment"># 可执行js，模仿用户操作。此处为将页面拉至最底端。</span></span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        body = driver.page_source</span><br><span class="line">        <span class="keyword">return</span> HtmlResponse(driver.current_url, body=body, encoding=<span class="string">&#x27;utf-8&#x27;</span>, request=request)</span><br></pre></td></tr></table></figure>

<p>如果不想在所有爬虫中使用，可以在reqeust中加meta参数来控制</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mapz"
      src="/images/link-300x300.gif">
  <p class="site-author-name" itemprop="name">Mapz</p>
  <div class="site-description" itemprop="description">FIND THE CHILD</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Mapz" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Mapz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">true</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

</body>
</html>
